"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[216],{8887:function(e,t,a){a.d(t,{Ql:function(){return r},Vc:function(){return l},sU:function(){return u},tf:function(){return o},uo:function(){return s}});var n=a(7542),i=a(8020);const r=async e=>{const t=await(0,n.I)().get("/request/delete",{searchParams:{request_id:e}});if(!t)throw new i.u(r.name);return t},s=async e=>{const t=await(0,n.I)().get("/request/get",{searchParams:{request_id:e}});if(!t)throw new i.u(s.name);return t},o=async e=>{const t=await(0,n.I)().get("/request/list",{searchParams:{...e}});if(!t)throw new i.u(o.name);return t},l=async e=>{const t=await(0,n.I)().post("/request/add",{...e,param:JSON.stringify(e.param),class_rate:JSON.stringify(e.class_rate),payoff_param:JSON.stringify(e.payoff_param)});if(!t)throw new i.u(l.name);return t},u=async e=>{const t=await(0,n.I)().post("/request/edit",{...e,param:JSON.stringify(e.param),class_rate:JSON.stringify(e.class_rate),payoff_param:JSON.stringify(e.payoff_param)});if(!t)throw new i.u(u.name);return t}},2192:function(e,t,a){a.d(t,{p:function(){return n}});const n=10},76:function(e,t,a){a.d(t,{k:function(){return n}});const n=(e,t=0)=>new Intl.NumberFormat("ru-RU",{minimumFractionDigits:t,maximumFractionDigits:t}).format("string"===typeof e?+e.replaceAll(/\s/g,"").replace(",","."):e).replace(",",".")},6126:function(e,t,a){a.d(t,{S:function(){return n}});const n=(e,t)=>e+t/100*e},7487:function(e,t,a){function n(e){const t=new Date(e),a=t.getDate(),n=t.getMonth()+1;return`${a>=10?a:"0"+a}.${n>=10?n:"0"+n}.${t.getFullYear()}`}a.d(t,{F:function(){return n}})},5430:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(3396),i=a(4870),r=a(7139);const s={key:0,class:"lac-pagination"};var o=(0,n.aZ)({__name:"LacPagination",props:{pageSize:{default:10},total:{default:10},page:{default:0}},emits:["update:page"],setup(e,{expose:t,emit:a}){const o=e,l=(0,i.Fl)((()=>Math.ceil(o.total/o.pageSize))),u=()=>{o.page>=o.total||a("update:page",o.page+1)},c=()=>{o.page<=0||a("update:page",o.page-1)};return(0,n.YP)((()=>o.total),(()=>{})),t({next:u,prev:c}),(e,t)=>{const a=(0,n.up)("Button");return(0,i.SU)(l)>0?((0,n.wg)(),(0,n.iD)("div",s,[(0,n.Wm)(a,{icon:"pi pi-arrow-left",disabled:!e.page,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:c},null,8,["disabled"]),(0,n.Uk)(" "+(0,r.zw)(e.page+1)+"/"+(0,r.zw)((0,i.SU)(l))+" ",1),(0,n.Wm)(a,{icon:"pi pi-arrow-right",disabled:e.page===(0,i.SU)(l)-1,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:u},null,8,["disabled"])])):(0,n.kq)("",!0)}}}),l=a(89);const u=(0,l.Z)(o,[["__scopeId","data-v-876429e4"]]);var c=u},5343:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(3396),i=a(4870),r=a(7139);const s={class:"lac-switch"},o=(0,n._)("div",{class:"lac-switch__desc"},"с НДС",-1);var l=(0,n.aZ)({__name:"LacSwitch",props:{modelValue:{type:Boolean},label:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=(0,i.Fl)({get(){return a.modelValue},set(e){return t("update:modelValue",e)}});return(e,t)=>{const a=(0,n.up)("InputSwitch");return(0,n.wg)(),(0,n.iD)("div",s,[(0,n.Wm)(a,{modelValue:(0,i.SU)(l),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,i.dq)(l)?l.value=e:null),class:(0,r.C_)({active:(0,i.SU)(l)})},null,8,["modelValue","class"]),o])}}});const u=l;var c=u},7554:function(e,t,a){a.r(t),a.d(t,{default:function(){return j}});var n=a(3396),i=(a(7658),a(7139)),r=a(4870),s=a(6408),o=a(9152),l=a(1020),u=a(3856),c=a(9286),d=a(8887),f=a(5845),p=a(2483),m=a(7487),g=a(258),w=a(5430),v=a(5343),_=a(6126),y=a(2192),k=a(3917),h=a(76);const b={class:"flex align-items-center justify-content-between pt16 pb16"},x={class:"flex align-items-center",style:{"font-size":"14px"}},S={class:"flex align-items-center"},D={key:2,class:"text-right"},q={key:4,class:"text-right"},z={key:7,class:"text-right"},U={key:8,class:"text-right"},O={key:9,class:"flex align-items-center"};var C=(0,n.aZ)({__name:"LacRequests",setup(e){const t=(0,p.tv)(),{dictionary:a,config:C}=(0,l.Jk)((0,f.o)()),H=(0,o.N)(),I=(0,g.S)(),{selectPartnerId:N}=(0,l.Jk)(H),{selectUserId:R}=(0,l.Jk)(I),V=(0,c.N)(),Z=(0,r.iH)(!1),j=(0,r.qj)([{text:"Дата",field:"edit_time",sort:"edit_time"},{text:"Покупатель",field:"partner.name",sort:"partner.name"},{text:"Пункт",field:"point.name",sort:"point.name"},{text:"Предмет",field:"subject",sort:"subject"},{text:"Вес, кг",field:"weight",sort:"weight"},{text:"БЦ, ₽/кг",field:"base_price",sort:"base_price"},{text:"Формула",field:"formula",sort:"formula"},{text:"Доставка",field:"payoff.param_base",sort:"payoff_param.base"},{text:"Тариф",field:"payoff.param_tarif",sort:"payoff_param.tarif"},{text:"ПР, ₽/кг",field:"other_price",sort:"other_price"},{text:"Статус",field:"status",sort:"status"},{text:"",field:"",sort:"",noSort:!0}]),F=(0,r.qj)({field:"edit_time",dir:s.O.DESC}),J=(0,r.iH)([]),W=(0,r.iH)(null),Y=(0,r.iH)(0),E=C.value.pagination?.request?.per_page||10,P=(0,r.iH)(E),L=(0,r.iH)(0),A=(0,r.iH)(!0);async function $(e){await t.push({name:"requestEdit",params:{id:e}})}async function M(e){const t=async()=>{try{V.open(u.y.LOADER);const t=await(0,d.Ql)(e);if(t.error)throw new Error(JSON.stringify(t.data.info)||"Что то пошло не так");const a=J.value.findIndex((t=>t.request_id===e));-1!==a&&(J.value.splice(a,1),L.value--),V.close()}catch(t){V.open(u.y.ERROR,{text:t.message})}};V.open(u.y.CONFIRM,{callback:t,text:"Удалить заявку?"})}function B(e,t){if(A.value){const a=Number(e),n=t||y.p,i=(0,_.S)(a,n);return(0,h.k)(i,2)}return(0,h.k)(e,2)}function G(e){const t=Object.values(a.value?.point?.subject).find((t=>t.val===e));return t?.desc||"unknown"}function Q(e){return a.value?.offer?.formula[e]||e}function K(e){return a.value.request.status[e]||"unknown"}async function T(){V.open(u.y.LOADER);const e={};e.page=Y.value,N.value&&(e.partner_id=N.value),R.value&&(e.user_id=R.value),P.value&&(e.size=P.value),F.dir&&(e.dir=F.dir),F.field&&(e.order=F.field);const t=await(0,d.tf)(e);!t.error&&t.data.info&&(J.value=t.data.info,L.value=t.data.count||0),Z.value=!0,V.close()}async function X(){await T(),Z.value=!0,await(0,n.Y3)()}(0,n.YP)((()=>[Y.value,F.dir,F.field,R.value,N.value]),(()=>{T()})),(0,n.bv)(X);const ee=e=>{V.open(u.y.LOADER),F.field=e.sortField,F.dir=e.sortOrder>0?s.O.ACS:s.O.DESC};return(e,t)=>{const s=(0,n.up)("Button"),o=(0,n.up)("RouterLink");return(0,n.wg)(),(0,n.iD)("div",{class:"lac-table-module wrapper",ref_key:"table",ref:W},[(0,n._)("div",b,[(0,n._)("div",x,[(0,n.Wm)(o,(0,n.dG)({to:{name:"requestCreate"}},e.$props,{custom:""}),{default:(0,n.w5)((({href:t,navigate:a})=>[(0,n.Wm)(s,(0,n.dG)({onClick:a,size:"small",label:"Добавить"},e.$attrs,{href:t}),null,16,["onClick","href"])])),_:1},16)]),(0,n._)("div",S,[(0,n.Wm)(v.Z,{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=e=>A.value=e),label:"с НДС"},null,8,["modelValue"]),(0,n.Wm)(w.Z,{page:Y.value,"onUpdate:page":t[1]||(t[1]=e=>Y.value=e),class:"ml-6",total:L.value,"page-size":P.value},null,8,["page","total","page-size"])])]),Z.value?((0,n.wg)(),(0,n.j4)(k.Z,{key:0,data:J.value,style:{"min-height":"0px"},fields:j,"sort-field":"edit_time",resizeMode:"expand","sort-order":-1,id:"requests",onSort:ee},{"column-body":(0,n.w5)((({data:e,field:t,render:o})=>["edit_time"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)((0,r.SU)(m.F)(1e3*(e.edit_time?e.edit_time:e.add_time))),1)],64)):"subject"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)((0,i.zw)(G(e.subject)),1)],64)):"weight"===t?((0,n.wg)(),(0,n.iD)("div",D,(0,i.zw)((0,r.SU)(h.k)(e.weight)),1)):"status"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:3},[(0,n.Uk)((0,i.zw)(K(e.status)),1)],64)):"base_price"===t?((0,n.wg)(),(0,n.iD)("div",q,(0,i.zw)(B(e.base_price)),1)):"formula"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:5},[(0,n.Uk)((0,i.zw)(Q(e.formula)),1)],64)):"payoff.param_base"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:6},[(0,n.Uk)((0,i.zw)(e.payoff?(0,r.SU)(a).request.payoff_base[e.payoff_param.base]?.desc||"unknown":"-"),1)],64)):"payoff.param_tarif"===t?((0,n.wg)(),(0,n.iD)("div",z,(0,i.zw)(e.payoff?B(e.payoff_param.tarif,e.payoff_param.vat_rate):""),1)):"other_price"===t?((0,n.wg)(),(0,n.iD)("div",U,(0,i.zw)((0,r.SU)(h.k)(e.other_price,2)),1)):t?((0,n.wg)(),(0,n.iD)(n.HY,{key:10},[(0,n.Uk)((0,i.zw)(o(e,t)),1)],64)):((0,n.wg)(),(0,n.iD)("div",O,[(0,n.Wm)(s,{onClick:t=>$(e.request_id),size:"small",icon:"pi pi-pencil",rounded:"",outlined:"",class:"border-none w-min h-min p-2",severity:"info"},null,8,["onClick"]),(0,n.Wm)(s,{onClick:t=>M(e.request_id),size:"small",icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",class:"border-none w-min h-min p-2"},null,8,["onClick"])]))])),_:1},8,["data","fields"])):(0,n.kq)("",!0)],512)}}}),H=a(89);const I=(0,H.Z)(C,[["__scopeId","data-v-1198d1d2"]]);var N=I;const R={class:"overflow-hidden flex flex-column"};var V=(0,n.aZ)({__name:"RequestsPage",setup(e){return(e,t)=>((0,n.wg)(),(0,n.iD)("div",R,[(0,n.Wm)(N,{class:"flex-grow-1"})]))}});const Z=V;var j=Z}}]);
//# sourceMappingURL=requests.4797ae87.js.map