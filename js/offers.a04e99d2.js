"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[54],{1482:function(e,t,a){a.d(t,{C9:function(){return u},Vv:function(){return c},g5:function(){return l},sh:function(){return o},wu:function(){return r},yw:function(){return s}});var n=a(7542),i=a(8020);const r=async e=>{const t=await(0,n.I)().get("/offer/calc",{searchParams:e});if(!t)throw new i.u(r.name);return t},l=async e=>{const t=await(0,n.I)().get("/offer/delete",{searchParams:{offer_id:e}});if(!t)throw new i.u(l.name);return t},o=async e=>{const t=await(0,n.I)().get("/offer/get",{searchParams:{offer_id:e}});if(!t)throw new i.u(o.name);return t},s=async e=>{const t=await(0,n.I)().get("/offer/list",{searchParams:{...e}});if(!t)throw new i.u(s.name);return t},u=async e=>{const t=await(0,n.I)().post("/offer/add",{...e,param:JSON.stringify(e.param)});if(!t)throw new i.u(u.name);return t},c=async e=>{const t=await(0,n.I)().post("/offer/edit",{...e,param:JSON.stringify(e.param)});if(!t)throw new i.u(c.name);return t}},2192:function(e,t,a){a.d(t,{p:function(){return n}});const n=10},76:function(e,t,a){a.d(t,{k:function(){return n}});const n=(e,t=0)=>new Intl.NumberFormat("ru-RU",{minimumFractionDigits:t,maximumFractionDigits:t}).format("string"===typeof e?+e.replaceAll(/\s/g,"").replace(",","."):e).replace(",",".")},6126:function(e,t,a){a.d(t,{S:function(){return n}});const n=(e,t)=>e+t/100*e},7487:function(e,t,a){function n(e){const t=new Date(e),a=t.getDate(),n=t.getMonth()+1;return`${a>=10?a:"0"+a}.${n>=10?n:"0"+n}.${t.getFullYear()}`}a.d(t,{F:function(){return n}})},5430:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(3396),i=a(4870),r=a(7139);const l={key:0,class:"lac-pagination"};var o=(0,n.aZ)({__name:"LacPagination",props:{pageSize:{default:10},total:{default:10},page:{default:0}},emits:["update:page"],setup(e,{expose:t,emit:a}){const o=e,s=(0,i.Fl)((()=>Math.ceil(o.total/o.pageSize))),u=()=>{o.page>=o.total||a("update:page",o.page+1)},c=()=>{o.page<=0||a("update:page",o.page-1)};return(0,n.YP)((()=>o.total),(()=>{})),t({next:u,prev:c}),(e,t)=>{const a=(0,n.up)("Button");return(0,i.SU)(s)>0?((0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(a,{icon:"pi pi-arrow-left",disabled:!e.page,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:c},null,8,["disabled"]),(0,n.Uk)(" "+(0,r.zw)(e.page+1)+"/"+(0,r.zw)((0,i.SU)(s))+" ",1),(0,n.Wm)(a,{icon:"pi pi-arrow-right",disabled:e.page===(0,i.SU)(s)-1,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:u},null,8,["disabled"])])):(0,n.kq)("",!0)}}}),s=a(89);const u=(0,s.Z)(o,[["__scopeId","data-v-876429e4"]]);var c=u},5343:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(3396),i=a(4870),r=a(7139);const l={class:"lac-switch"},o=(0,n._)("div",{class:"lac-switch__desc"},"с НДС",-1);var s=(0,n.aZ)({__name:"LacSwitch",props:{modelValue:{type:Boolean},label:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,s=(0,i.Fl)({get(){return a.modelValue},set(e){return t("update:modelValue",e)}});return(e,t)=>{const a=(0,n.up)("InputSwitch");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(a,{modelValue:(0,i.SU)(s),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,i.dq)(s)?s.value=e:null),class:(0,r.C_)({active:(0,i.SU)(s)})},null,8,["modelValue","class"]),o])}}});const u=s;var c=u},2557:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});a(7658);var n=a(3396),i=a(7139),r=a(4870),l=a(6408),o=a(9152),s=a(1020),u=a(9286),c=a(3856),d=a(1482),f=a(5845),p=a(7487),m=a(2483),v=a(76),w=a(258),g=a(5430),_=a(5343),y=a(2192),k=a(6126),h=a(3917);const x={class:"flex align-items-center justify-content-between pt16 pb16"},b={class:"flex align-items-center",style:{"font-size":"14px"}},D={class:"flex align-items-center"},S={key:1,class:"text-right"},z={key:2,class:"text-right"},U={key:7,class:"text-right"},C={key:8,class:"flex align-items-center"};var H=(0,n.aZ)({__name:"LacOffers",setup(e){const t=(0,m.tv)(),{config:a,dictionary:H}=(0,s.Jk)((0,f.o)()),I=(0,o.N)(),O=(0,w.S)(),{selectPartnerId:Z}=(0,s.Jk)(I),{selectUserId:V}=(0,s.Jk)(O),Y=(0,u.N)(),j=(0,r.iH)(!1),F=(0,r.qj)([{text:"Дата",sort:"edit_time",field:"edit_time"},{text:"Поставщик",sort:"partner_name",field:"partner.name"},{text:"Пункт",sort:"point_name",field:"point.name"},{text:"Предмет",sort:"subject",field:"subject"},{text:"Вес, кг",sort:"weight",field:"weight"},{text:"БЦ, ₽/кг",sort:"base_price",field:"base_price"},{text:"Формула",sort:"formula",field:"formula"},{text:"Белок, %",sort:"param.actual_protein",field:"param.actual_protein"},{text:"Жир, %",sort:"param.actual_fat",field:"param.actual_fat"},{text:"Сухие, %",sort:"param.actual_dry_matter",field:"param.actual_dry_matter"},{text:"Сорт",sort:"class",field:"class"},{text:"ПР, ₽/кг",sort:"other_price",field:"other_price"},{text:"КЦ, ₽/кг",sort:"final_price",field:"final_price"},{text:"Статус",sort:"status",field:"status"},{text:"",sort:"",field:"",noSort:!0}]),P=["param.actual_protein","param.actual_fat","param.actual_dry_matter","other_price"],R=(0,r.qj)({field:"edit_time",dir:l.O.DESC}),W=(0,r.iH)([]),E=(0,r.iH)(null),N=(0,r.iH)(0),L=a.value.pagination?.offer?.per_page||10,J=(0,r.iH)(L),q=(0,r.iH)(0),A=(0,r.iH)(!0);function $(e){if(A.value){const t=Number(e),a=H.value.offer.vat_rate||y.p,n=(0,k.S)(t,a);return(0,v.k)(n,2)}return(0,v.k)(e,2)}function M(e){const t=Object.values(H.value?.point?.subject).find((t=>t.val===e));return t?.desc||"unknown"}function B(e){return H.value?.offer?.formula[e]||e}function G(e){return H.value?.point?.class[e]||e}function K(e){return H.value.offer.status[e]||"unknown"}async function Q(e){await t.push({name:"offerEdit",params:{id:e}})}async function T(e){const t=async()=>{try{Y.open(c.y.LOADER);const t=await(0,d.g5)(e);if(t.error)throw new Error(JSON.stringify(t.data.info)||"Что то пошло не так");const a=W.value.findIndex((t=>t.offer_id===e));-1!==a&&(W.value.splice(a,1),q.value--),Y.close()}catch(t){Y.open(c.y.ERROR,{text:t.message})}};Y.open(c.y.CONFIRM,{callback:t,text:"Удалить предложение?"})}async function X(){Y.open(c.y.LOADER);const e={};e.page=N.value,Z.value&&(e.partner_id=Z.value),V.value&&(e.user_id=V.value),J.value&&(e.size=J.value),R.dir&&(e.dir=R.dir),R.field&&(e.order=R.field);const t=await(0,d.yw)(e);!t.error&&t.data.info&&(W.value=t.data.info,q.value=t.data.count||0),Y.close()}async function ee(){await X(),j.value=!0,await(0,n.Y3)()}(0,n.YP)((()=>[Z.value,V.value]),(()=>{N.value=0})),(0,n.YP)((()=>[N.value,R.dir,R.field,V.value,Z.value]),(()=>{X()})),(0,n.bv)(ee);const te=e=>{Y.open(c.y.LOADER),R.field=e.sortField,R.dir=e.sortOrder>0?l.O.ACS:l.O.DESC};return(e,t)=>{const a=(0,n.up)("Button"),l=(0,n.up)("RouterLink");return(0,n.wg)(),(0,n.iD)("div",{class:"lac-table-module",ref_key:"table",ref:E},[(0,n._)("div",x,[(0,n._)("div",b,[(0,n.Wm)(l,(0,n.dG)({to:{name:"offerCreate"}},e.$props,{custom:""}),{default:(0,n.w5)((({href:t,navigate:i})=>[(0,n.Wm)(a,(0,n.dG)({onClick:i,size:"small",label:"Добавить"},e.$attrs,{href:t}),null,16,["onClick","href"])])),_:1},16)]),(0,n._)("div",D,[(0,n.Wm)(_.Z,{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=e=>A.value=e),label:"с НДС"},null,8,["modelValue"]),(0,n.Wm)(g.Z,{page:N.value,"onUpdate:page":t[1]||(t[1]=e=>N.value=e),class:"ml-6",total:q.value,"page-size":J.value},null,8,["page","total","page-size"])])]),j.value?((0,n.wg)(),(0,n.j4)(h.Z,{key:0,data:W.value,style:{"min-height":"0px"},fields:F,"sort-field":"edit_time","sort-order":-1,resizeMode:"expand",id:"offers",onSort:te},{"column-body":(0,n.w5)((({data:e,field:t,render:l})=>["edit_time"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)((0,r.SU)(p.F)(1e3*(e.edit_time?e.edit_time:e.add_time))),1)],64)):"weight"===t?((0,n.wg)(),(0,n.iD)("div",S,(0,i.zw)((0,r.SU)(v.k)(e[t])),1)):P.includes(t)?((0,n.wg)(),(0,n.iD)("div",z,(0,i.zw)(l(e,t)&&(0,r.SU)(v.k)(l(e,t),2)),1)):"status"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:3},[(0,n.Uk)((0,i.zw)(K(e.status)),1)],64)):"formula"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:4},[(0,n.Uk)((0,i.zw)(B(e.formula)),1)],64)):"class"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:5},[(0,n.Uk)((0,i.zw)(G(e.class)),1)],64)):"subject"===t?((0,n.wg)(),(0,n.iD)(n.HY,{key:6},[(0,n.Uk)((0,i.zw)(M(e.subject)),1)],64)):"base_price"===t||"final_price"===t?((0,n.wg)(),(0,n.iD)("div",U,(0,i.zw)($(e[t])),1)):t?((0,n.wg)(),(0,n.iD)(n.HY,{key:9},[(0,n.Uk)((0,i.zw)(l(e,t)),1)],64)):((0,n.wg)(),(0,n.iD)("div",C,[(0,n.Wm)(a,{onClick:t=>Q(e.offer_id),size:"small",icon:"pi pi-pencil",rounded:"",outlined:"",class:"border-none w-min h-min p-2",severity:"info"},null,8,["onClick"]),(0,n.Wm)(a,{onClick:t=>T(e.offer_id),size:"small",icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",class:"border-none w-min h-min p-2"},null,8,["onClick"])]))])),_:1},8,["data","fields"])):(0,n.kq)("",!0)],512)}}}),I=a(89);const O=(0,I.Z)(H,[["__scopeId","data-v-5d8a83f6"]]);var Z=O},5303:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var n=a(3396),i=a(9043),r=a(4870);const l={class:"lac-map"};var o=(0,n.aZ)({__name:"ChainPage",setup(e){const t=(0,r.iH)(null),a=(0,r.iH)([]);return(e,r)=>((0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(i.Z,{markers:a.value,ref_key:"mapRef",ref:t},null,8,["markers"])]))}});const s=o;var u=s}}]);
//# sourceMappingURL=offers.a04e99d2.js.map