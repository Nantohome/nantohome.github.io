"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[318],{7273:function(e,a,t){t.d(a,{B2:function(){return d},Mq:function(){return s},Xy:function(){return r},ax:function(){return u},o$:function(){return i}});var l=t(7542),n=t(8020);const i=async e=>{const a=await(0,l.I)().get("/event/get",{searchParams:{event_id:e}});if(!a)throw new n.u(i.name);return a},u=async e=>{const a=await(0,l.I)().get("/event/delete",{searchParams:{event_id:e}});if(!a)throw new n.u(u.name);return a},r=async e=>{const a=await(0,l.I)().get("/event/list",{searchParams:{...e}});if(!a)throw new n.u(r.name);return a},s=async e=>{const a=await(0,l.I)().post("/event/add",e);if(!a)throw new n.u(s.name);return a},d=async e=>{const a=await(0,l.I)().post("/event/edit",e);if(!a)throw new n.u(d.name);return a}},5601:function(e,a,t){t.d(a,{F:function(){return l}});const l=e=>{if(!e.length)return e;let a=e.split("-");return a.length>1?a.reverse().join("."):(a=a[0].split("."),a.length>1?a.reverse().join("-"):e)}},1712:function(e,a,t){t.d(a,{j:function(){return s}});var l=t(4870),n=t(6945),i=t(1020),u=t(4008),r=t(5845);const s=()=>{const{dictionary:e}=(0,i.Jk)((0,r.o)()),a=(0,l.qj)({planned_date:{value:"",id:"planned_date",label:"Плановая дата",rules:(0,n.v)()},planned_time:{value:"",id:"planned_time",label:"Плановое время",rules:(0,n.v)()},fact_date:{value:"",id:"fact_date",label:"Фактическая дата",rules:(0,n.v)()},fact_time:{value:"",id:"fact_time",label:"Фактическое время",rules:(0,n.v)()},type:{value:null,id:"role",label:"Тип",items:Object.entries(e.value.event.type).map((([e,a])=>({value:e,text:a}))),rules:(0,n.v)()},agent:{value:null,id:"agent",label:"Сотрудник",items:[],rules:(0,n.v)()},partner:{value:null,id:"partner",label:"Контрагент",items:[],rules:(0,n.v)()},comment:{id:"comment",label:"Комментарий",value:"",rules:(0,u.F)()}});return{fields:a}}},5211:function(e,a,t){t.d(a,{I:function(){return l}});const l=e=>{function a(){const a=new Date(e.planned_date.value),t=e.planned_time.value.split(":").map((e=>Number(e)));a.setHours(t[0],t[1]);const l=e.fact_date.value?new Date(e.fact_date.value):null;if(l){const a=e.fact_time.value.split(":").map((e=>Number(e)));l.setHours(a[0],a[1])}const n=e.agent.value?Number(e.agent.value.value):0,i=e.type.value?e.type.value.value:"",u={planned_time:a.getTime()/1e3,agent_id:n||9,type:i};return l&&(u.actual_time=l.getTime()/1e3),e.comment.value&&(u.comment=e.comment.value),u}return{prepareData:a}}},890:function(e,a,t){t.d(a,{S:function(){return i}});var l=t(9286),n=t(3856);const i=()=>{const e=(0,l.N)();function a(a){return async()=>{try{e.open(n.y.LOADER),await a(),e.close()}catch(t){e.open(n.y.ERROR,{text:t.message})}}}return{initTemplate:a}}},354:function(e,a,t){t.d(a,{e:function(){return u}});var l=t(9286),n=t(3856),i=t(2483);const u=e=>{const a=(0,l.N)(),t=(0,i.tv)();function u(l,i){return async()=>{if(await e())try{a.open(n.y.LOADER),await l(),!i&&a.open(n.y.SUCCESS,{callback:()=>t.back()})}catch(u){a.open(n.y.ERROR,{text:u.message})}}}return{submitTemplate:u}}},6144:function(e,a,t){t.d(a,{Z:function(){return v}});var l=t(3396),n=t(7139),i=t(5838),u=t(4870),r=t(4219),s=t(3435),d=(0,l.aZ)({__name:"LacInputText",props:{label:{},placeholder:{},id:{},value:{},icon:{},rules:{},type:{},labelPosition:{},disabled:{type:Boolean}},emits:["update:value"],setup(e,{expose:a,emit:t}){const d=e,o=(0,s.p)(),v=((0,u.iH)(!1),(0,r.ZP)({props:{value:d.rules||{}}},{props:d})),c=(0,l.Fl)((()=>!!v.value.$errors.length)),m=(0,l.Fl)({get(){return d.value},set(e){t("update:value",e)}});async function p(){const e=await v.value.$validate();return e||o.add({severity:"error",summary:d.label,detail:v.value.$errors[0].$message}),e}function f(){v.value.$reset()}return a({validate:p,validationReset:f,id:d.id}),(e,a)=>{const t=(0,l.up)("InputText");return(0,l.wg)(),(0,l.j4)(i.Z,{id:d.id,label:d.label,labelPosition:d.labelPosition},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),id:d.id,placeholder:d.placeholder,type:e.type?e.type:"text",disabled:e.disabled,class:(0,n.C_)(["w-full",{"p-invalid":c.value}]),onBlur:a[1]||(a[1]=a=>e.$emit("blur",e.event))},null,8,["modelValue","id","placeholder","type","disabled","class"])])),_:1},8,["id","label","labelPosition"])}}});const o=d;var v=o},1931:function(e,a,t){t.r(a),t.d(a,{default:function(){return N}});var l=t(3396),n=t(4870),i=t(2793),u=t(9242),r=t(140),s=t(9546),d=t(7174),o=t(6144),v=t(1411),c=t(4436),m=t(1735),p=t(5211),f=t(354),S=t(890),U=t(1712),b=t(9358),g=t(7273),_=t(9152),y=t(6646),w=t(1020),h=t(5601);const Z=e=>{const{setFieldRef:a,validateForm:t,resetValidations:l}=(0,m.Z)(),i=(0,n.iH)(!1),u=(0,n.iH)(!0),r=(0,n.iH)(null),s=(0,_.N)(),{selectPartnerId:d,partners:o}=(0,w.Jk)(s),{fields:v}=((0,y.F)(),(0,U.j)()),{prepareData:c}=(0,p.I)(v),{submitTemplate:Z}=(0,f.e)(t),{initTemplate:F}=(0,S.S)(),{updateAgent:P,updatePartner:W}=(0,b.P)(i);async function I(e){const a=await(0,g.o$)(e);!a.error&&a.data.info&&(r.value=a.data.info)}function $(e){const a={date:"",time:""};if("number"===typeof e){const t=new Date(1e3*e),l=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),u=t.getHours(),r=t.getMinutes();a.date=`${i>=10?i:"0"+i}.${n>=10?n:"0"+n}.${l}`,a.time=`${u>=10?u:"0"+u}:${r>=10?r:"0"+r}`}return a}async function R(){if(r.value){const e=r.value.partner_id,a=r.value.agent.agent_id;await W(v.partner,e),await P(v.agent,e,a);const t=$(r.value.planned_time);v.planned_date.value=(0,h.F)(t.date),v.planned_time.value=t.time;const l=$(r.value.actual_time);v.fact_date.value=(0,h.F)(l.date),v.fact_time.value=l.time;const n=v.type.items.find((e=>e.value===r.value.type));n&&(v.type.value=n),r.value.comment&&(v.comment.value=r.value.comment)}}async function k(){await I(e),await R(),i.value=!0}async function D(){const a=c(),t=await(0,g.B2)({...a,event_id:e});if(t.error)throw new Error(t.data.info?JSON.stringify(t.data.info,null,2):"Не удалось отредактировать событие")}return{setFieldRef:a,validateForm:t,resetValidations:l,fields:v,init:F(k),submit:Z(D),isInit:i,isChanged:u,fetchData:I,fillForm:R}};var F=t(5623),P=t(9286);const W=["onSubmit"];var I=(0,l.aZ)({__name:"LacEventEditForm",props:{id:{}},setup(e){const a=e,{setFieldRef:t,validateForm:i,resetValidations:m,fields:p,init:f,isInit:S,submit:U}=((0,_.N)(),(0,P.N)(),Z(Number(a.id))),{updateAgent:g}=(0,b.P)(S),{onSelectSearch:y}=(0,F.z)(S),{fieldVariant:w}=(0,c.U)(),{computedCols:h}=(0,v.b)();async function I(){await U()}return(0,l.bv)((async()=>{await f()})),(0,l.YP)((()=>p.partner.value?.value),(async e=>{if(S.value){const a=e?parseInt(e):void 0;await g(p.agent,a)}})),(e,a)=>{const i=(0,l.up)("Button");return(0,n.SU)(S)?((0,l.wg)(),(0,l.iD)("form",{key:0,class:"lac-form",onSubmit:(0,u.iM)(I,["prevent"])},[(0,l.Wm)(r.Z,{title:"Общие параметры",class:"mb16",grid:(0,n.SU)(h)},{default:(0,l.w5)((()=>[(0,l.Wm)(d.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).partner.value,"onUpdate:value":a[0]||(a[0]=e=>(0,n.SU)(p).partner.value=e),items:(0,n.SU)(p).partner.items,id:(0,n.SU)(p).partner.id,label:(0,n.SU)(p).partner.label,placeholder:"",searchable:"","show-clear":"","clear-on-close":"",onSearch:a[1]||(a[1]=e=>(0,n.SU)(y)(e,(0,n.SU)(p).partner)),ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).partner.available,rules:(0,n.SU)(p).partner.rules},null,8,["variant","value","items","id","label","disabled","rules"]),(0,l.Wm)(d.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).agent.value,"onUpdate:value":a[2]||(a[2]=e=>(0,n.SU)(p).agent.value=e),items:(0,n.SU)(p).agent.items,id:(0,n.SU)(p).agent.id,label:(0,n.SU)(p).agent.label,placeholder:"",ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).partner.value||!(0,n.SU)(p).agent.available,rules:(0,n.SU)(p).agent.rules},null,8,["variant","value","items","id","label","disabled","rules"]),(0,l.Wm)(o.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).planned_date.value,"onUpdate:value":a[3]||(a[3]=e=>(0,n.SU)(p).planned_date.value=e),id:(0,n.SU)(p).planned_date.id,label:(0,n.SU)(p).planned_date.label,rules:(0,n.SU)(p).planned_date.rules,type:"date",ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(o.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).planned_time.value,"onUpdate:value":a[4]||(a[4]=e=>(0,n.SU)(p).planned_time.value=e),id:(0,n.SU)(p).planned_time.id,label:(0,n.SU)(p).planned_time.label,rules:(0,n.SU)(p).planned_time.rules,type:"time",ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(o.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).fact_date.value,"onUpdate:value":a[5]||(a[5]=e=>(0,n.SU)(p).fact_date.value=e),id:(0,n.SU)(p).fact_date.id,label:(0,n.SU)(p).fact_date.label,rules:(0,n.SU)(p).fact_date.rules,type:"date",disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(o.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).fact_time.value,"onUpdate:value":a[6]||(a[6]=e=>(0,n.SU)(p).fact_time.value=e),id:(0,n.SU)(p).fact_time.id,label:(0,n.SU)(p).fact_time.label,rules:(0,n.SU)(p).fact_time.rules,type:"time",disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(d.Z,{variant:(0,n.SU)(w),value:(0,n.SU)(p).type.value,"onUpdate:value":a[7]||(a[7]=e=>(0,n.SU)(p).type.value=e),items:(0,n.SU)(p).type.items,id:(0,n.SU)(p).type.id,label:(0,n.SU)(p).type.label,placeholder:"",ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value,rules:(0,n.SU)(p).type.rules},null,8,["variant","value","items","id","label","disabled","rules"])])),_:1},8,["grid"]),(0,l.Wm)(r.Z,{class:"mb8",grid:(0,n.SU)(h)},null,8,["grid"]),(0,l.Wm)(r.Z,{title:"Комментарий",class:"mb8"},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,{"no-resize":"",rows:3,value:(0,n.SU)(p).comment.value,"onUpdate:value":a[8]||(a[8]=e=>(0,n.SU)(p).comment.value=e),id:(0,n.SU)(p).comment.id,rules:(0,n.SU)(p).comment.rules,ref:(0,n.SU)(t),disabled:!(0,n.SU)(p).agent.value||!(0,n.SU)(p).agent.value.value},null,8,["value","id","rules","disabled"])])),_:1}),(0,l.Wm)(i,{type:"submit",label:"Сохранить"})],40,W)):(0,l.kq)("",!0)}}});const $=I;var R=$,k=t(2483),D=(0,l.aZ)({__name:"EventEditPage",setup(e){const a=(0,k.yj)();return(e,t)=>((0,l.wg)(),(0,l.j4)(i.Z,{title:"Редактирование события"},{default:(0,l.w5)((()=>[(0,l.Wm)(R,{id:(0,n.SU)(a).params.id},null,8,["id"])])),_:1}))}});const E=D;var N=E}}]);
//# sourceMappingURL=eventEdit.cd22338b.js.map