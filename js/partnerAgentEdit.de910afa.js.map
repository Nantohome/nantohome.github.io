{"version":3,"file":"js/partnerAgentEdit.de910afa.js","mappings":"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","sources":["webpack://lac/./src/kernel/api/methods/AgentRole.ts","webpack://lac/./src/kernel/validation/vuelidate/phoneRules.ts","webpack://lac/./src/views/modules/CrudForms/LacAgentForm/useAgentForm.ts","webpack://lac/./src/views/modules/CrudForms/LacAgentForm/LacAgentEditForm.vue?9e5a","webpack://lac/./src/views/modules/CrudForms/LacAgentForm/LacAgentEditForm.vue","webpack://lac/./src/views/pages/partner/PartnerAgentEditPage.vue?496c","webpack://lac/./src/views/pages/partner/PartnerAgentEditPage.vue"],"sourcesContent":["import { getHttp } from \"@/kernel/api/http\";\r\nimport { ApiResponseType, ApiRequestListOptionsType } from \"@/kernel/api/types\";\r\nimport { NotRequestException } from \"@/kernel/lib/exceptions/not-request.exception\";\r\nimport { RoleAddData } from \"@/kernel/api/dto/AgentRole\";\r\n\r\nexport const getAgentRoleDelete = async (\r\n  role: string\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().get<ApiResponseType | false>(\r\n    \"/agent/role/delete\",\r\n    {\r\n      searchParams: {\r\n        role,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(getAgentRoleDelete.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const getAgentRoleList = async (\r\n  params: ApiRequestListOptionsType = {}\r\n): Promise<ApiResponseType<string[]>> => {\r\n  const res = await getHttp().get<ApiResponseType<string[]> | false>(\r\n    \"/agent/role/list\",\r\n    { searchParams: { ...params, size: 30 } }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(getAgentRoleList.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const postAgentRoleAdd = async (\r\n  payload: RoleAddData\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().post<ApiResponseType | false>(\r\n    \"/agent/role/add\",\r\n    payload\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(postAgentRoleAdd.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const postAgentRoleEdit = async (\r\n  oldRole: string,\r\n  newRole: string\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().post<ApiResponseType | false>(\r\n    \"/agent/role/edit\",\r\n    {\r\n      old_role: oldRole,\r\n      new_role: newRole,\r\n    }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(postAgentRoleEdit.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n","import {\r\n  helpers,\r\n  maxLength,\r\n  minLength,\r\n  numeric,\r\n  required,\r\n} from \"@vuelidate/validators\";\r\n\r\nconst clear = (value: string): string => value.replace(/\\D/g, \"\");\r\n\r\nexport const phoneRules = () => ({\r\n  required: helpers.withMessage(\"Это поле обязательно\", required),\r\n  minLength: helpers.withMessage(\r\n    \"Длина телефона должна быть не менее 10 символов\",\r\n    (value: string) => clear(value).length >= 10\r\n  ),\r\n  maxLength: helpers.withMessage(\r\n    \"Длина телефона должна быть не более 12 символов\",\r\n    (value: string) => clear(value).length <= 12\r\n  ),\r\n});\r\n","import { reactive } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { ReactiveVariable } from \"vue/macros\";\r\nimport {\r\n  FormFieldProps,\r\n  FormFieldSelectProps,\r\n  LacSelectOption,\r\n} from \"@/views/components/form/types\";\r\nimport { useFormValidate } from \"@/use/useFormValidate\";\r\nimport { requiredRules } from \"@/kernel/validation/vuelidate/requiredRules\";\r\nimport { phoneRules } from \"@/kernel/validation/vuelidate/phoneRules\";\r\nimport { emailRules } from \"@/kernel/validation/vuelidate/emailRules\";\r\nimport { maxLengthRules } from \"@/kernel/validation/vuelidate/maxLengthRules\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { AgentEntity } from \"@/kernel/entities/Agent\";\r\nimport { PhoneForm } from \"@/kernel/entities/types\";\r\nimport { useStoreAgent } from \"@/store/agent\";\r\nimport { useStore } from \"@/store\";\r\n\r\nexport const useAgentForm = (employeeRoles: string[]) => {\r\n  const router = useRouter();\r\n  const storeAgent = useStoreAgent();\r\n  const { setFieldRef, validateForm, resetValidations } = useFormValidate();\r\n  const { dictionary } = storeToRefs(useStore());\r\n\r\n  const selectOptions = employeeRoles.map((el) => ({ value: el, text: el }));\r\n\r\n  const employeeRole: ReactiveVariable<FormFieldSelectProps> = reactive({\r\n    value: null,\r\n    id: \"role\",\r\n    label: \"Должность\",\r\n    items: selectOptions,\r\n    rules: requiredRules(),\r\n  });\r\n\r\n  const agentPhone: ReactiveVariable<PhoneForm[]> = reactive([]);\r\n\r\n  const fields: ReactiveVariable<Record<string, FormFieldProps>> = reactive({\r\n    name: {\r\n      value: \"\",\r\n      id: \"name\",\r\n      label: \"ФИО\",\r\n      rules: requiredRules(),\r\n    },\r\n    phone: {\r\n      value: \"\",\r\n      id: \"phone\",\r\n      label: \"Телефон\",\r\n      rules: phoneRules(),\r\n    },\r\n    dob: {\r\n      value: \"\",\r\n      id: \"dob\",\r\n      label: \"Дата рождения\",\r\n    },\r\n    email: {\r\n      value: \"\",\r\n      id: \"email\",\r\n      label: \"E-mail\",\r\n      rules: emailRules(),\r\n    },\r\n    comment: {\r\n      value: \"\",\r\n      id: \"comment\",\r\n      rules: maxLengthRules(),\r\n    },\r\n  });\r\n\r\n  function prepareData(): any {\r\n    const res: Record<string, any> = {};\r\n\r\n    Object.entries(fields).forEach(([key, value]) => {\r\n      if (value.value) {\r\n        res[key] = value.value;\r\n      }\r\n    });\r\n\r\n    res.phone = [];\r\n    for (const phone of agentPhone) {\r\n      if (phone.phone && phone.type.value) {\r\n        res.phone.push(phone);\r\n      }\r\n    }\r\n\r\n    res.role = employeeRole.value\r\n      ? (employeeRole.value as LacSelectOption).value\r\n      : \"\";\r\n\r\n    return res as any;\r\n  }\r\n\r\n  function removeAgentPhone(index: number) {\r\n    if (agentPhone.length > 1) {\r\n      agentPhone.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  function addAgentPhone(phone?: PhoneForm[]) {\r\n    if (phone) {\r\n      for (const p of phone) {\r\n        agentPhone.push({\r\n          phone: p.phone,\r\n          type: p.type,\r\n          extra: p.extra,\r\n        });\r\n      }\r\n    } else {\r\n      agentPhone.push({\r\n        phone: \"\",\r\n        type: { value: \"work\", text: dictionary.value.phone.type[\"work\"] },\r\n        extra: \"\",\r\n      });\r\n    }\r\n  }\r\n\r\n  function clear() {\r\n    Object.values(fields).forEach((el) => (el.value = \"\"));\r\n    employeeRole.value = null;\r\n    resetValidations();\r\n  }\r\n\r\n  function successCallback(variant: string) {\r\n    router.back();\r\n  }\r\n\r\n  function fillFromSelectedAgent(agent: AgentEntity) {\r\n    employeeRole.value =\r\n      selectOptions.find((el) => el.value === agent.role) || null;\r\n\r\n    addAgentPhone(agent.phone);\r\n\r\n    fields.name.value = agent.name;\r\n    fields.dob.value = agent.dob || \"\";\r\n    fields.email.value = agent.email || \"\";\r\n    fields.comment.value = agent.comment || \"\";\r\n  }\r\n\r\n  async function addAgent(payload: any) {\r\n    await storeAgent.add(payload);\r\n  }\r\n\r\n  async function editAgent(payload: any) {\r\n    await storeAgent.edit(payload);\r\n  }\r\n\r\n  async function getAgent(id: number) {\r\n    return await storeAgent.get(id);\r\n  }\r\n\r\n  return {\r\n    employeeRole,\r\n    agentPhone,\r\n    fields,\r\n    successCallback,\r\n    prepareData,\r\n    setFieldRef,\r\n    validateForm,\r\n    fillFromSelectedAgent,\r\n    addAgent,\r\n    editAgent,\r\n    getAgent,\r\n    addAgentPhone,\r\n    removeAgentPhone,\r\n  };\r\n};\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = [\"onSubmit\"]\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"br\", null, null, -1)\n\nimport { onMounted, Ref, ref } from \"vue\";\r\nimport LacFieldset from \"@/views/components/form/field/LacFieldset.vue\";\r\nimport LacInputText from \"@/views/components/form/input/LacInputText.vue\";\r\nimport LacTextarea from \"@/views/components/form/input/LacTextarea.vue\";\r\nimport LacSelect from \"@/views/components/form/select/LacSelect.vue\";\r\nimport LacPhone from \"@/views/components/form/input/LacPhone.vue\";\r\n\r\nimport { useStoreModal } from \"@/store/modal\";\r\nimport { AvailableModalsEnum } from \"@/store/modal/types\";\r\nimport { useFieldsetCols } from \"@/views/components/form/field/useFieldsetCols\";\r\nimport { useAgentForm } from \"@/views/modules/CrudForms/LacAgentForm/useAgentForm\";\r\nimport { AgentEntity } from \"@/kernel/entities/Agent\";\r\nimport { useRouter } from \"vue-router\";\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'LacAgentEditForm',\n  props: {\n    agentId: {},\n    employeeRoles: {}\n  },\n  setup(__props: any) {\n\nconst props = __props;\n\r\nconst router = useRouter();\r\n\r\nconst { computedCols } = useFieldsetCols();\r\nconst {\r\n  fields,\r\n  employeeRole,\r\n  agentPhone,\r\n  setFieldRef,\r\n  successCallback,\r\n  validateForm,\r\n  prepareData,\r\n  editAgent,\r\n  getAgent,\r\n  fillFromSelectedAgent,\r\n  addAgentPhone,\r\n  removeAgentPhone,\r\n} = useAgentForm(props.employeeRoles);\r\nconst data: Ref<AgentEntity | null> = ref(null);\r\n\r\nconst modals = useStoreModal();\r\n\r\nasync function onSubmit(): Promise<void> {\r\n  const isValid = await validateForm();\r\n  if (isValid) {\r\n    try {\r\n      modals.open(AvailableModalsEnum.LOADER);\r\n      if (data.value) {\r\n        const partner_id = data.value.partner_id;\r\n        await editAgent({\r\n          ...prepareData(),\r\n          partner_id: partner_id,\r\n          agent_id: data.value.agent_id,\r\n        });\r\n      }\r\n      modals.open(AvailableModalsEnum.SUCCESS, { callback: successCallback });\r\n    } catch (e) {\r\n      modals.open(AvailableModalsEnum.ERROR, {\r\n        text: (e as ErrorEvent).message,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  try {\r\n    modals.open(AvailableModalsEnum.LOADER);\r\n    data.value = await getAgent(Number(props.agentId));\r\n    fillFromSelectedAgent(data.value);\r\n    modals.close();\r\n  } catch (e) {\r\n    modals.close();\r\n    await router.back();\r\n  }\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_Button = _resolveComponent(\"Button\")!\n\n  return (_openBlock(), _createElementBlock(\"form\", {\n    class: \"lac-form-long-dropdown lac-create-agent-form\",\n    onSubmit: _withModifiers(onSubmit, [\"prevent\"])\n  }, [\n    _createVNode(LacFieldset, {\n      title: \"Общие параметры\",\n      class: \"mb16 lac-fieldset-params\",\n      grid: _unref(computedCols)\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).name.value,\n          \"onUpdate:value\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(fields).name.value) = $event)),\n          id: _unref(fields).name.id,\n          label: _unref(fields).name.label,\n          rules: _unref(fields).name.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacInputText, {\n          class: \"lac-fieldset-params-dob\",\n          variant: \"horizontal\",\n          value: _unref(fields).dob.value,\n          \"onUpdate:value\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(fields).dob.value) = $event)),\n          id: _unref(fields).dob.id,\n          label: _unref(fields).dob.label,\n          rules: _unref(fields).dob.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef),\n          type: \"date\"\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacSelect, {\n          class: \"lac-fieldset-role\",\n          variant: \"horizontal\",\n          value: _unref(employeeRole).value,\n          \"onUpdate:value\": _cache[2] || (_cache[2] = ($event: any) => ((_unref(employeeRole).value) = $event)),\n          items: _unref(employeeRole).items,\n          id: _unref(employeeRole).id,\n          label: _unref(employeeRole).label,\n          rules: _unref(employeeRole).rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"items\", \"id\", \"label\", \"rules\"])\n      ]),\n      _: 1\n    }, 8, [\"grid\"]),\n    _createVNode(LacFieldset, {\n      title: \"Контакты\",\n      class: \"mb16 lac-fieldset-contacts\"\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacInputText, {\n          class: \"lac-fieldset-contacts-email\",\n          variant: \"horizontal\",\n          value: _unref(fields).email.value,\n          \"onUpdate:value\": _cache[3] || (_cache[3] = ($event: any) => ((_unref(fields).email.value) = $event)),\n          id: _unref(fields).email.id,\n          label: _unref(fields).email.label,\n          rules: _unref(fields).email.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _hoisted_2,\n        _createVNode(LacPhone, {\n          value: _unref(agentPhone),\n          onAdd: _unref(addAgentPhone),\n          onRemove: _unref(removeAgentPhone)\n        }, null, 8, [\"value\", \"onAdd\", \"onRemove\"])\n      ]),\n      _: 1\n    }),\n    _createVNode(LacFieldset, {\n      title: \"Комментарий\",\n      class: \"mb8\"\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacTextarea, {\n          \"no-resize\": \"\",\n          rows: 3,\n          value: _unref(fields).comment.value,\n          \"onUpdate:value\": _cache[4] || (_cache[4] = ($event: any) => ((_unref(fields).comment.value) = $event)),\n          id: _unref(fields).comment.id,\n          rules: _unref(fields).comment.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"rules\"])\n      ]),\n      _: 1\n    }),\n    _createVNode(_component_Button, {\n      type: \"submit\",\n      label: \"Сохранить\"\n    })\n  ], 40, _hoisted_1))\n}\n}\n\n})","import script from \"./LacAgentEditForm.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./LacAgentEditForm.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./LacAgentEditForm.vue?vue&type=style&index=0&id=75e24112&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, withCtx as _withCtx } from \"vue\"\n\nimport FormTemplate from \"@/views/templates/FormTemplate/FormTemplate.vue\";\r\nimport { onBeforeMount, Ref, ref } from \"vue\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport LacAgentEditForm from \"@/views/modules/CrudForms/LacAgentForm/LacAgentEditForm.vue\";\r\nimport { AvailableModalsEnum } from \"@/store/modal/types\";\r\nimport { getAgentRoleList } from \"@/kernel/api/methods/AgentRole\";\r\nimport { useStoreModal } from \"@/store/modal\";\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'PartnerAgentEditPage',\n  setup(__props) {\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst modals = useStoreModal();\r\nconst employeeRoles: Ref<string[]> = ref([]);\r\nconst isReady = ref(false);\r\n\r\nonBeforeMount(async () => {\r\n  try {\r\n    modals.open(AvailableModalsEnum.LOADER);\r\n\r\n    const employeeRolesRes = await getAgentRoleList();\r\n    if (employeeRolesRes.error || !employeeRolesRes.data?.info?.length) {\r\n      const callback = () => {\r\n        location.href = new URL(location.href).toString();\r\n      };\r\n      modals.open(AvailableModalsEnum.ERROR, {\r\n        text: \"Ошибка. Отсутствуют должности агентов\",\r\n        callback,\r\n      });\r\n      return;\r\n    } else {\r\n      employeeRoles.value = employeeRolesRes.data.info;\r\n    }\r\n\r\n    isReady.value = true;\r\n\r\n    modals.close();\r\n  } catch (e) {\r\n    modals.close();\r\n    await router.back();\r\n  }\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createBlock(FormTemplate, { title: \"Редактирование сотрудника\" }, {\n    default: _withCtx(() => [\n      (isReady.value)\n        ? (_openBlock(), _createBlock(LacAgentEditForm, {\n            key: 0,\n            \"agent-id\": _unref(route).params.id,\n            employeeRoles: employeeRoles.value\n          }, null, 8, [\"agent-id\", \"employeeRoles\"]))\n        : _createCommentVNode(\"\", true)\n    ]),\n    _: 1\n  }))\n}\n}\n\n})","import script from \"./PartnerAgentEditPage.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./PartnerAgentEditPage.vue?vue&type=script&lang=ts&setup=true\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["getAgentRoleDelete","async","res","getHttp","get","searchParams","role","NotRequestException","name","getAgentRoleList","params","size","postAgentRoleAdd","post","payload","postAgentRoleEdit","oldRole","newRole","old_role","new_role","clear","value","replace","phoneRules","required","helpers","withMessage","minLength","length","maxLength","useAgentForm","employeeRoles","router","useRouter","storeAgent","useStoreAgent","setFieldRef","validateForm","resetValidations","useFormValidate","dictionary","storeToRefs","useStore","selectOptions","map","el","text","employeeRole","reactive","id","label","items","rules","requiredRules","agentPhone","fields","phone","dob","email","emailRules","comment","maxLengthRules","prepareData","Object","entries","forEach","key","type","push","removeAgentPhone","index","splice","addAgentPhone","p","extra","successCallback","variant","back","fillFromSelectedAgent","agent","find","addAgent","add","editAgent","edit","getAgent","_hoisted_1","_hoisted_2","_createElementVNode","_defineComponent","__name","props","agentId","setup","__props","computedCols","useFieldsetCols","data","ref","modals","useStoreModal","onSubmit","isValid","open","AvailableModalsEnum","LOADER","partner_id","agent_id","SUCCESS","callback","e","ERROR","message","onMounted","Number","close","_ctx","_cache","_component_Button","_resolveComponent","_openBlock","_createElementBlock","class","_withModifiers","_createVNode","LacFieldset","title","grid","_unref","default","_withCtx","LacInputText","$event","placeholder","LacSelect","_","LacPhone","onAdd","onRemove","LacTextarea","rows","__exports__","route","useRoute","isReady","onBeforeMount","employeeRolesRes","error","info","location","href","URL","toString","_createBlock","FormTemplate","LacAgentEditForm","_createCommentVNode"],"sourceRoot":""}