"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[203],{7229:function(e,l,a){a.d(l,{d:function(){return f}});a(7658);var n=a(3396),t=a(4870),u=a(5845),r=a(1020),i=a(1735),s=a(9152),o=a(6342),v=a(4008),c=a(6945),m=a(5420);const d=()=>({required:m.BM.withMessage("Это поле обязательно",m.C1),numeric:m.BM.withMessage("ИНН может состоять только из цифр",m.uR),inn:m.BM.withMessage("Длина ИНН должна быть 10 или 12 символов",(e=>10===e.length||12===e.length))});var p=a(2483);const f=()=>{const e=(0,p.tv)(),l=(0,p.yj)(),a=parseInt(l.params.id),{setFieldRef:m,validateForm:f,resetValidations:U}=(0,i.Z)(),b=(0,s.N)(),{partners:S}=(0,r.Jk)(b),{dictionary:h}=(0,r.Jk)((0,u.o)()),w=(0,n.Fl)((()=>{const e=h.value?h.value.partner.type:{};return Object.keys(e).map((e=>b.createPartnerType(e)))})),y=(0,t.qj)({value:null,id:"type",label:"Тип",items:w,rules:(0,c.v)()}),P=(0,t.qj)([]),Z=(0,t.qj)({inn:{value:"",id:"inn",label:"ИНН",rules:d()},fullname:{value:"",id:"fullname",label:"Полное наименование",rules:(0,c.v)()},name:{value:"",id:"name",label:"Краткое наименование",rules:(0,c.v)()},website:{value:"",id:"website",label:"Сайт"},email:{value:"",id:"email",label:"E-mail",rules:(0,o.D)()},comment:{value:"",id:"comment",rules:(0,v.F)()}});function k(e){if(e)for(const l of e)P.push({phone:l.phone,type:l.type,extra:l.extra,typeDisabled:!0});else P.push({phone:"",type:{value:"work",text:h.value.phone.type["work"]},extra:"",typeDisabled:!0})}function W(e){P.length>1&&P.splice(e,1)}function g(){const e={};Object.entries(Z).forEach((([l,a])=>{a.value&&(e[l]=a.value)})),e.phone=[];for(const l of P)l.phone&&l.type.value&&e.phone.push(l);return e.type=y.value?y.value.value:"",e}function C(){Object.values(Z).forEach((e=>e.value="")),y.value=null,U()}function F(l){C(),e.back()}async function R(){void 0===S.value[a]&&await b.fetch(a),y.value=w.value.find((e=>e.value===S.value[a].type.value))||null,k(S.value[a].phone),Z.fullname.value=S.value[a].fullname,Z.inn.value=S.value[a].inn,Z.name.value=S.value[a].name,Z.website.value=S.value[a].website||"",Z.email.value=S.value[a].email||"",Z.comment.value=S.value[a].comment||""}async function j(){await b.edit(g(),a)}return{partnerType:y,partnerPhone:P,fields:Z,successCallback:F,prepareData:g,setFieldRef:m,validateForm:f,editPartner:j,fillFromSelectedPartner:R,addPartnerPhone:k,removePartnerPhone:W}}},622:function(e,l,a){a.r(l),a.d(l,{default:function(){return Z}});var n=a(3396),t=a(9242),u=a(4870),r=a(140),i=a(6144),s=a(9546),o=a(7174),v=a(3874),c=a(9152),m=a(9286),d=a(3856),p=a(7229),f=a(1411);const U=["onSubmit"];var b=(0,n.aZ)({__name:"LacCreatePartnerForm",setup(e){const{computedCols:l}=(0,f.b)(),{fields:a,partnerType:b,partnerPhone:S,setFieldRef:h,successCallback:w,validateForm:y,prepareData:P,addPartnerPhone:Z,removePartnerPhone:k}=(0,p.d)();Z();const W=(0,c.N)(),g=(0,m.N)();async function C(){const e=await y();if(e)try{g.open(d.y.LOADER),await W.create(P()),g.open(d.y.SUCCESS,{callback:w})}catch(l){g.open(d.y.ERROR,{text:l.message})}}return(e,c)=>{const m=(0,n.up)("Button");return(0,n.wg)(),(0,n.iD)("form",{class:"lac-form lac-create-partner-form",onSubmit:(0,t.iM)(C,["prevent"])},[(0,n.Wm)(r.Z,{title:"Общие параметры",class:"mb16 lac-fieldset-params",grid:(0,u.SU)(l)},{default:(0,n.w5)((()=>[(0,n.Wm)(i.Z,{variant:"horizontal",value:(0,u.SU)(a).fullname.value,"onUpdate:value":c[0]||(c[0]=e=>(0,u.SU)(a).fullname.value=e),id:(0,u.SU)(a).fullname.id,label:(0,u.SU)(a).fullname.label,rules:(0,u.SU)(a).fullname.rules,placeholder:"",ref:(0,u.SU)(h)},null,8,["value","id","label","rules"]),(0,n.Wm)(o.Z,{variant:"horizontal",value:(0,u.SU)(b).value,"onUpdate:value":c[1]||(c[1]=e=>(0,u.SU)(b).value=e),items:(0,u.SU)(b).items,id:(0,u.SU)(b).id,label:(0,u.SU)(b).label,rules:(0,u.SU)(b).rules,placeholder:"",ref:(0,u.SU)(h)},null,8,["value","items","id","label","rules"]),(0,n.Wm)(i.Z,{variant:"horizontal",value:(0,u.SU)(a).name.value,"onUpdate:value":c[2]||(c[2]=e=>(0,u.SU)(a).name.value=e),id:(0,u.SU)(a).name.id,label:(0,u.SU)(a).name.label,rules:(0,u.SU)(a).name.rules,placeholder:"",ref:(0,u.SU)(h)},null,8,["value","id","label","rules"]),(0,n.Wm)(i.Z,{variant:"horizontal",value:(0,u.SU)(a).inn.value,"onUpdate:value":c[3]||(c[3]=e=>(0,u.SU)(a).inn.value=e),id:(0,u.SU)(a).inn.id,label:(0,u.SU)(a).inn.label,rules:(0,u.SU)(a).inn.rules,placeholder:"",ref:(0,u.SU)(h)},null,8,["value","id","label","rules"])])),_:1},8,["grid"]),(0,n.Wm)(r.Z,{title:"Контакты",class:"mb16 lac-fieldset-contacts"},{default:(0,n.w5)((()=>[(0,n.Wm)(i.Z,{variant:"horizontal",value:(0,u.SU)(a).website.value,"onUpdate:value":c[4]||(c[4]=e=>(0,u.SU)(a).website.value=e),id:(0,u.SU)(a).website.id,label:(0,u.SU)(a).website.label,placeholder:"",ref:(0,u.SU)(h),class:"lac-fieldset-contacts-website"},null,8,["value","id","label"]),(0,n.Wm)(i.Z,{variant:"horizontal",value:(0,u.SU)(a).email.value,"onUpdate:value":c[5]||(c[5]=e=>(0,u.SU)(a).email.value=e),id:(0,u.SU)(a).email.id,label:(0,u.SU)(a).email.label,rules:(0,u.SU)(a).email.rules,placeholder:"",class:"lac-fieldset-contacts-email",ref:(0,u.SU)(h)},null,8,["value","id","label","rules"]),(0,n.Wm)(v.Z,{value:(0,u.SU)(S),onAdd:(0,u.SU)(Z),onRemove:(0,u.SU)(k)},null,8,["value","onAdd","onRemove"])])),_:1}),(0,n.Wm)(r.Z,{title:"Комментарий",class:"mb8"},{default:(0,n.w5)((()=>[(0,n.Wm)(s.Z,{"no-resize":"",rows:3,value:(0,u.SU)(a).comment.value,"onUpdate:value":c[6]||(c[6]=e=>(0,u.SU)(a).comment.value=e),id:(0,u.SU)(a).comment.id,rules:(0,u.SU)(a).comment.rules,placeholder:"",ref:(0,u.SU)(h)},null,8,["value","id","rules"])])),_:1}),(0,n.Wm)(m,{type:"submit",label:"Добавить"})],40,U)}}});const S=b;var h=S,w=a(2793),y=(0,n.aZ)({__name:"PartnerCreatePage",setup(e){return(e,l)=>((0,n.wg)(),(0,n.j4)(w.Z,{title:"Добавление контрагента"},{default:(0,n.w5)((()=>[(0,n.Wm)(h)])),_:1}))}});const P=y;var Z=P}}]);
//# sourceMappingURL=partnerCreate.5c2f23fa.js.map