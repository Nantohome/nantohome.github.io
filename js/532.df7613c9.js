"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[532],{8887:function(a,e,t){t.d(e,{Ql:function(){return u},Vc:function(){return o},sU:function(){return n},tf:function(){return i},uo:function(){return s}});var r=t(7542),l=t(8020);const u=async a=>{const e=await(0,r.I)().get("/request/delete",{searchParams:{request_id:a}});if(!e)throw new l.u(u.name);return e},s=async a=>{const e=await(0,r.I)().get("/request/get",{searchParams:{request_id:a}});if(!e)throw new l.u(s.name);return e},i=async a=>{const e=await(0,r.I)().get("/request/list",{searchParams:{...a}});if(!e)throw new l.u(i.name);return e},o=async a=>{const e=await(0,r.I)().post("/request/add",{...a,param:JSON.stringify(a.param),class_rate:JSON.stringify(a.class_rate),payoff_param:JSON.stringify(a.payoff_param)});if(!e)throw new l.u(o.name);return e},n=async a=>{const e=await(0,r.I)().post("/request/edit",{...a,param:JSON.stringify(a.param),class_rate:JSON.stringify(a.class_rate),payoff_param:JSON.stringify(a.payoff_param)});if(!e)throw new l.u(n.name);return e}},2192:function(a,e,t){t.d(e,{p:function(){return r}});const r=10},76:function(a,e,t){t.d(e,{k:function(){return r}});const r=(a,e=0)=>new Intl.NumberFormat("ru-RU",{minimumFractionDigits:e,maximumFractionDigits:e}).format("string"===typeof a?+a.replaceAll(/\s/g,"").replace(",","."):a).replace(",",".")},8225:function(a,e,t){t.d(e,{x:function(){return l}});var r=t(5420);const l=a=>({min:r.BM.withMessage(`Минимальное значение ${a||0}`,(e=>Number(e.replace(/\s/g,""))>=(a||0)))})},3537:function(a,e,t){t.d(e,{y:function(){return O}});var r=t(1735),l=t(4870),u=t(6945),s=t(8225),i=t(4008);const o=()=>{const a={partner:{value:null,id:"partner_id",label:"Покупатель",items:[],rules:(0,u.v)(),placeholder:""},point:{value:null,id:"point_id",label:"Пункт",items:[],rules:(0,u.v)(),placeholder:"",available:!0},subject:{value:null,id:"subject",label:"Предмет",items:[],rules:(0,u.v)(),placeholder:"",available:!1},statusSelect:{value:null,id:"status",label:"Статус",items:[],rules:(0,u.v)(),placeholder:"Выберите статус",available:!0},weight:{id:"weight",label:"Вес",value:"",unit:"кг",step:1e3,min:0,max:1e5,afterDot:0,rules:{...(0,u.v)(),...(0,s.x)(1)},available:!0}},e={base_price:{id:"base_price",label:"Базовая цена (без НДС)",unit:"₽/кг",value:"",hidden:"",afterDot:2,step:.5,min:0,max:50,rules:(0,u.v)(),available:!0},base_dry_matter:{id:"base_dry_matter",label:"Базовые сухие вещества",unit:"%",value:"",available:!0},base_price_with_tax:{id:"base_price_with_tax",label:"Базовая цена (с НДС)",unit:"₽/кг",value:"",afterDot:2,step:.5,min:0,max:55,available:!0},protein_rate:{id:"protein_rate",label:"Доля показателя белка",unit:"%",value:"",available:!0},formula:{value:null,id:"formula",label:"Тип формулы рассчета",items:[],rules:(0,u.v)(),placeholder:"",available:!0},fat_rate:{id:"fat_rate",label:"Доля показателя жира",unit:"%",value:"",available:!0},base_protein:{id:"base_protein",label:"Базовый белок",unit:"%",value:"",available:!0},protein_correction:{id:"protein_correction",label:"Поправка на белок",unit:"коп",value:"",available:!0},base_fat:{id:"base_fat",label:"Базовый жир",unit:"%",value:"",available:!0},fat_correction:{id:"fat_correction",label:"Поправки на жир",unit:"коп",value:"",available:!0},max_fat:{id:"max_fat",label:"Потолок жира",unit:"%",value:"",available:!0}},t={ultra:{id:"class_ultra",label:"Ультра",value:"1.000",afterDot:3,step:.1,available:!0,rules:(0,u.v)()},second:{id:"class_second",label:"2-ой сорт",value:"1.000",afterDot:3,step:.1,available:!0,rules:(0,u.v)()},extra:{id:"class_extra",label:"Высший",value:"1.000",afterDot:3,step:.1,available:!0,rules:(0,u.v)()},not_sorted:{id:"class_not_sorted",label:"Несортовое",value:"1.000",afterDot:3,step:.1,available:!0,rules:(0,u.v)()},first:{id:"class_first",label:"1-ый сорт",value:"1.000",afterDot:3,step:.1,available:!0,rules:(0,u.v)()}},r={payoff_base:{value:null,id:"payoff_base",label:"База компенсации",items:[],rules:(0,u.v)(),placeholder:"Выберите базу компенсации",available:!0},payoff_vat:{id:"payoff_vat",label:"Ставка НДС в тарифе",available:!0,items:[{value:"10",text:"10%"},{value:"20",text:"20%"}],value:null,rules:(0,u.v)(),unit:"%"},payoff_tariff:{id:"payoff_tariff",label:"Тариф (без НДС)",unit:"₽",value:"",afterDot:2,step:.5,available:!0,rules:(0,u.v)()},payoff_tariff_with_vat:{id:"payoff_tariff_with_vat",label:"Тариф (с НДС)",unit:"₽",value:"",afterDot:2,step:.5,available:!0,rules:(0,u.v)()}},o=(0,l.qj)({commonParams:a,baseParams:e,sortParams:t,other:{other_price:{id:"other_price",label:"Прочие расходы",unit:"₽/кг",value:"",afterDot:2,step:.1,min:0,max:10,available:!0},comment:{id:"comment",label:"Комментарий",value:"",rules:(0,i.F)()}},calculateParams:r});return{fields:o}};var n=t(3856),c=t(8887),m=t(9286),f=t(2483);const v=a=>{function e(){if(!a.commonParams.partner.value||!a.commonParams.subject.value||!a.commonParams.statusSelect.value||!a.baseParams.formula.value||!a.baseParams.base_price.hidden)return null;const e={partner_id:Number(a.commonParams.partner.value?.value),status:a.commonParams.statusSelect.value?.value,weight:Number(a.commonParams.weight.value.replace(/\s/g,"")),base_price:Number(a.baseParams.base_price.hidden),other_price:Number(a.other.other_price.value),payoff:a.calculateParams.payoff_base.value?1:0,class_rate:{ultra:Number(a.sortParams.ultra.value),extra:Number(a.sortParams.extra.value),first:Number(a.sortParams.first.value),second:Number(a.sortParams.second.value),not_sorted:Number(a.sortParams.not_sorted.value)},payoff_param:{base:a.calculateParams.payoff_base.value?.value||"",tarif:Number(a.calculateParams.payoff_tariff.value),vat_rate:Number(a.calculateParams.payoff_vat.value?.value)},param:{subject:a.commonParams.subject.value.value,formula:a.baseParams.formula.value?.value}};return a.other.comment.value&&(e.comment=a.other.comment.value),Object.entries(a.baseParams).filter((([a,e])=>e.available&&"formula"!==a&&"base_price"!==a&&"base_price_with_tax"!==a)).forEach((([a,t])=>{e.param[a]=t.value})),a.commonParams.point.value&&(e.point_id=Number(a.commonParams.point.value.value)),e}return{prepareData:e}},p=a=>{const e=(0,m.N)(),t=(0,f.tv)(),{prepareData:r}=v(a);async function l(){const a=r();if(a){e.open(n.y.LOADER);const r=await(0,c.Vc)(a);r.error?e.open(n.y.ERROR,{text:r.data.info||"Ошибка создания предложения"}):e.open(n.y.SUCCESS,{callback:()=>t.back()})}}async function u(a){const l=r();if(l){e.open(n.y.LOADER);const r=await(0,c.sU)({...l,request_id:a});r.error?e.open(n.y.ERROR,{text:r.data.info||"Ошибка редактирования запроса"}):e.open(n.y.SUCCESS,{callback:()=>t.back()})}}return{submit:l,submitEdit:u}};var b=t(3396),d=t(2192),_=t(5845),P=t(1020),y=t(76);const h=a=>{const{dictionary:e}=(0,P.Jk)((0,_.o)()),t=(0,l.iH)(!1);function r(){a.commonParams.subject.value&&"milk"===a.commonParams.subject.value.value&&a.baseParams.formula.value&&"standart"==a.baseParams.formula.value.value&&(a.baseParams.fat_rate.value=String(100-Number(a.baseParams.protein_rate.value)))}function u(r){if(!t.value){t.value=!0;const l=Number(a.baseParams.base_price.value),u=Number(a.baseParams.base_price.hidden);r?(a.baseParams.base_price.hidden=l.toFixed(4),a.baseParams.base_price.value=l.toFixed(2)):(u>(a.baseParams.base_price.max||0)||u<(a.baseParams.base_price.min||0))&&(a.baseParams.base_price.hidden=l.toFixed(4)),a.baseParams.base_price_with_tax.value=(l*((e.value.offer.vat_rate||d.p)/100)+l).toFixed(2),(0,b.Y3)().then((()=>{t.value=!1}))}}function s(){if(!t.value){t.value=!0;const r=Number(a.baseParams.base_price_with_tax.value),l=r/(1+(e.value.offer.vat_rate||d.p)/100);a.baseParams.base_price.hidden=l.toFixed(4),a.baseParams.base_price.value=l.toFixed(2),(0,b.Y3)().then((()=>{t.value=!1}))}}const i=(0,l.iH)(!1);async function o(){if(!i.value){i.value=!0;const e=Number(a.calculateParams.payoff_vat.value?.value);e&&!isNaN(e)||(a.calculateParams.payoff_tariff_with_vat.value=(0,y.k)(a.calculateParams.payoff_tariff.value,a.calculateParams.payoff_tariff_with_vat.afterDot));const t=Number(a.calculateParams.payoff_tariff.value);a.calculateParams.payoff_tariff_with_vat.value=(0,y.k)(t*(e/100)+t,2),await(0,b.Y3)(),i.value=!1}}async function n(){if(!i.value){i.value=!0;const e=Number(a.calculateParams.payoff_vat.value?.value);e&&!isNaN(e)||(a.calculateParams.payoff_tariff.value=(0,y.k)(a.calculateParams.payoff_tariff_with_vat.value,2));const t=Number(a.calculateParams.payoff_tariff_with_vat.value);a.calculateParams.payoff_tariff.value=(0,y.k)(t/(1+e/100),2),await(0,b.Y3)(),i.value=!1}}return{recalculateFatRate:r,recalculateBasePrice:s,recalculateBasePriceWithVat:u,recalculatePayoffTariff:o,recalculatePayoffTariffWithTax:n}},x=a=>{const{dictionary:e}=(0,P.Jk)((0,_.o)());function t(){const t=e.value.offer.formula,r=e.value.offer.available_formula_by_subject;if(a.baseParams.formula.items=Object.entries(t).filter((([e,t])=>!!a.commonParams.subject.value?.value&&r[a.commonParams.subject.value.value].some((a=>a===e)))).map((([a,e])=>({value:a,text:e}))),"milk"===a.commonParams.subject.value?.value){const e=a.baseParams.formula.items.find((a=>"standart"===a.value));if(e)a.baseParams.formula.value=e;else{const e=a.baseParams.formula.items.find((a=>"physical_weight"===a.value));e&&(a.baseParams.formula.value=e)}}else{const e=a.baseParams.formula.items.find((a=>"physical_weight"===a.value));e&&(a.baseParams.formula.value=e)}}return{setFormula:t}};var w=t(9358),g=(t(7658),t(9152));const N=a=>{const{dictionary:e}=(0,P.Jk)((0,_.o)());function t(){const t=e.value.offer.property,r=["protein_rate","base_dry_matter","base_fat","base_protein","fat_correction","fat_rate","max_fat","protein_correction","protein_rate"];r.forEach((e=>{a.baseParams[e]&&(a.baseParams[e].available=!1)}));const l=e=>{const r=a.baseParams.formula.value?.value||"",l=a.commonParams.subject.value?.value||"",u=a[e],s=Object.entries(t);if(u){const a=Object.entries(u).filter((([a,e])=>s.some((([e,t])=>e===a))));a.forEach((([a,e])=>{e.value=""}))}s.forEach((([t,u])=>{const s=a[e][t],i=u.cond[r]?.[l];s&&i&&("number"===typeof i.max?s.max=i.max:delete s.max,"number"===typeof i.min?s.min=i.min:delete s.min,"number"===typeof i.fix?(s.min=i.fix,s.max=i.fix,s.fix=i.fix):delete s.fix,"number"===typeof i.after_dot?s.afterDot=i.after_dot:delete s.afterDot,"number"===typeof i.step?s.step=i.step:delete s.step,s.available=!0,void 0!==i.def?s.value="number"===typeof s.afterDot?i.def.toFixed(s.afterDot):String(i.def):s.value="number"===typeof i.fix?"number"===typeof s.afterDot?i.fix.toFixed(s.afterDot):String(i.fix):"",a[e][t]=s)}))};l("baseParams"),Number(a.baseParams.protein_rate.value)+Number(a.baseParams.fat_rate.value)>100&&(a.baseParams.fat_rate.value=String(100-Number(a.baseParams.protein_rate.value)))}return{initialParams:t}};var D=t(7954);const S=(a,e,t)=>{const r=(0,D.I)();async function l(){a.commonParams.point.value=null;const l=parseInt(a.commonParams.partner.value?.value||"0");await r.getAllPoints();const u=r.getPoints({partner_id:l,noStore:!0})||[];if(a.commonParams.point.items=u.filter((a=>a.subject_to_buy.length)).map((a=>({value:String(a.point_id),text:a.name})))||[],a.commonParams.point.available=!!a.commonParams.point.items.length,1===a.commonParams.point.items.length&&(a.commonParams.point.value=a.commonParams.point.items[0]),!e.value&&t.value){const e=a.commonParams.point.items.find((a=>a.value===String(t.value.point.point_id)));e&&(a.commonParams.point.value=e)}}return{updatePoints:l}},F=(a,e,t,r)=>{const l=(0,m.N)(),{dictionary:u}=(0,P.Jk)((0,_.o)()),s=(0,g.N)(),{selectPartnerId:i,partners:o}=(0,P.Jk)(s),{setFormula:c}=x(a),{updatePoints:f}=S(a,e,t),{initialParams:v}=N(a),{updatePartner:p,updatePoint:d,updateSubject:y,updateFormula:h,updateStatus:D}=(0,w.P)(e);async function F(){let e,r,l,u,s,i;t.value&&(e=!0,r=t.value.partner.partner_id,l=t.value.point.point_id,u=t.value.subject,s=t.value.formula,i=t.value.status),await p(a.commonParams.partner,r),!e&&a.commonParams.partner.value&&(r=parseInt(a.commonParams.partner.value.value)),await d(a.commonParams.point,"request",r,l),!e&&a.commonParams.point.value&&(l=parseInt(a.commonParams.point.value.value)),await y(a.commonParams.subject,"request",l,u);const o=a.commonParams.subject.value?a.commonParams.subject.value.value:void 0;await h(a.baseParams.formula,o,s),await D(a.commonParams.statusSelect,"request",i),a.commonParams.subject.value&&v()}async function j(){await F(),a.calculateParams.payoff_base.items.push(...Object.entries(u.value.request.payoff_base).map((([a,e])=>({value:a,text:e.desc}))));const e=a.calculateParams.payoff_base.items.find((a=>"rub_per_kg"===a.value));e&&(a.calculateParams.payoff_base.value=e),a.calculateParams.payoff_vat.value=a.calculateParams.payoff_vat.items.find((a=>"20"===a.value))||null}async function k(){l.open(n.y.LOADER),await j(),e.value=!0,await(0,b.Y3)(),r(),l.close()}return{init:k}},j=(a,e)=>{const t=(0,l.iH)(!1),{updateSubject:r,updatePoint:u,updateFormula:s,initialParams:i,recalculateBasePrice:o,recalculateBasePriceWithVat:n,recalculateFatRate:c,recalculatePayoffTariff:m,recalculatePayoffTariffWithTax:f}=e;function v(){(0,b.YP)((()=>a.commonParams.partner.value?.value),(async e=>{if(t.value)return;const r=e?parseInt(e):void 0;await u(a.commonParams.point,"request",r)})),(0,b.YP)((()=>a.commonParams.point.value?.value),(async e=>{if(t.value)return;const l=e?parseInt(e):void 0;await r(a.commonParams.subject,"request",l)})),(0,b.YP)((()=>a.commonParams.subject.value),(async()=>{if(t.value)return;const e=a.commonParams.subject.value?a.commonParams.subject.value.value:void 0;await s(a.baseParams.formula,e),i()})),(0,b.YP)((()=>a.baseParams.formula.value),(()=>{t.value||i()})),(0,b.YP)((()=>a.baseParams.protein_rate.value),(()=>{t.value||c()})),(0,b.YP)((()=>[a.baseParams.base_price.value,a.baseParams.base_price.hidden]),(([,a],[,e])=>{t.value||a!==e&&n()})),(0,b.YP)((()=>a.baseParams.base_price_with_tax.value),(()=>{t.value||o()})),(0,b.YP)((()=>[a.calculateParams.payoff_vat.value,a.calculateParams.payoff_tariff.value]),(async()=>{t.value||await m()})),(0,b.YP)((()=>a.calculateParams.payoff_tariff_with_vat.value),(async()=>{t.value||await f()}))}return{setWatchers:v,lockWatchers:()=>t.value=!0,unlockWatchers:()=>t.value=!1}},k=(a,e,t,r,l)=>{const{updatePoints:u}=S(a,t,e),{setFormula:s}=x(a),{initialParams:i}=N(a),{recalculateBasePriceWithVat:o,recalculatePayoffTariff:n}=h(a);async function c(){if(!e.value)return;t.value=!1,r(),a.commonParams.weight.value=(0,y.k)(e.value.weight),a.baseParams.base_price.value=String(e.value.base_price),o(!0),Object.entries(a.sortParams).map((([a,t])=>{const r=e.value?.class_rate[a];r&&(t.value=r.toFixed(3))})),e.value?.other_price&&(a.other.other_price.value=String(e.value.other_price));const u=e.value?.param;if(u&&(u.base_protein&&(a.baseParams.base_protein.value=String(u.base_protein)),u.base_fat&&(a.baseParams.base_fat.value=String(u.base_fat)),u.protein_rate&&(a.baseParams.protein_rate.value=String(u.protein_rate)),u.fat_rate&&(a.baseParams.fat_rate.value=String(u.fat_rate)),u.max_fat&&(a.baseParams.max_fat.value=String(u.max_fat))),e.value?.payoff&&e.value?.payoff_param){const t=a.calculateParams.payoff_base.items.find((a=>a.value===e.value.payoff_param.base));t&&(a.calculateParams.payoff_base.value=t);const r=a.calculateParams.payoff_vat.items.find((a=>a.value===String(e.value?.payoff_param.vat_rate)));r&&(a.calculateParams.payoff_vat.value=r),a.calculateParams.payoff_tariff.value=(0,y.k)(e.value?.payoff_param.tarif,a.calculateParams.payoff_tariff.afterDot),await n()}e.value?.comment&&(a.other.comment.value=e.value?.comment),await(0,b.Y3)(),t.value=!0,l()}return{fillForm:c}},q=()=>{const a=(0,l.iH)(null);async function e(e){const t=await(0,c.uo)(e);!t.error&&t.data.info&&(a.value=t.data.info)}return{fetchData:e,requestData:a}},O=()=>{const{setFieldRef:a,validateForm:e,resetValidations:t}=(0,r.Z)(),u=(0,l.iH)(!1),s=(0,l.iH)(!0),{fields:i}=o(),{requestData:n,fetchData:c}=q(),{submit:m,submitEdit:f}=p(i),{setFormula:v}=x(i),{updatePoint:b,updateSubject:d,updateFormula:_,updateStatus:P}=(0,w.P)(u),{initialParams:y}=N(i),{recalculateFatRate:g,recalculateBasePriceWithVat:D,recalculatePayoffTariff:S,recalculatePayoffTariffWithTax:O,recalculateBasePrice:R}=h(i),{setWatchers:E,lockWatchers:I,unlockWatchers:W}=j(i,{recalculateFatRate:g,recalculateBasePriceWithVat:D,recalculateBasePrice:R,recalculatePayoffTariffWithTax:O,recalculatePayoffTariff:S,updateSubject:d,updatePoint:b,updateFormula:_,initialParams:y}),{init:Y}=F(i,u,n,E),{fillForm:T}=k(i,n,u,I,W);return{fields:i,setFieldRef:a,validateForm:e,resetValidations:t,init:Y,fetchData:c,fillForm:T,isInit:u,submit:m,submitEdit:f,isChanged:s}}},3653:function(a,e,t){t.d(e,{Z:function(){return p}});var r=t(3396),l=t(7139),u=t(5838),s=t(4870),i=t(4219),o=t(76),n=t(3435);const c={class:"p-inputgroup flex-1"},m={class:"p-inputgroup-addon",style:{background:"#fafafa"}};var f=(0,r.aZ)({__name:"LacInputNumber",props:{label:{},placeholder:{},id:{},value:{},hidden:{},icon:{},rules:{},type:{},disabled:{type:Boolean},step:{default:1},min:{},max:{},afterDot:{},suffix:{},localePrettify:{type:Boolean}},emits:["update:value","focus","blur"],setup(a,{expose:e,emit:t}){const f=a,v=(0,n.p)(),p=((0,s.iH)(!1),(0,i.ZP)({props:{value:f.rules||{}}},{props:f})),b=(0,r.Fl)((()=>!!p.value.$errors.length)),d=(0,r.Fl)({get(){return f.value},set(a){t("update:value",a.replace(",","."))}});async function _(){const a=await p.value.$validate();return a||v.add({severity:"error",summary:f.label,detail:p.value.$errors[0].$message}),a}function P(){p.value.$reset()}async function y(a){await(0,r.Y3)(),window.removeEventListener("keyup",w),"base_price"===a&&t("blur",d.value),d.value=f.localePrettify?(0,o.k)(x(d.value),f.afterDot||0):x(d.value)}function h(a){"base_price"===a&&t("focus"),window.addEventListener("keyup",w)}function x(a){let e=Number(String(a).replace(/\s/g,"").replace(",","."));"number"===typeof f.max&&"number"===typeof f.min&&f.max===f.min?e=f.max:("number"===typeof f.max&&e>f.max&&(e=f.max),"number"===typeof f.min&&e<f.min&&(e=f.min));let t=Number.isNaN(e)?"0":"number"===typeof f.afterDot?e.toFixed(f.afterDot):String(e);return t}function w(a){38!==a.keyCode?40!==a.keyCode||D():N()}function g(a){return a.replace(",",".").split(".")}function N(){const a=x(d.value),e=g(a),t=f.afterDot||e[1]?e[1].length:0;let r="1";for(let s=0;s<t;s++)r+="0";const l=f.afterDot?Number(Number(a).toFixed(f.afterDot)):Number(a);let u=(l*Number(r)+f.step*Number(r))/Number(r);f.max&&u>f.max&&(u=f.max),d.value=x(String(u))}function D(){const a=x(d.value),e=g(a),t=f.afterDot||e[1]?e[1].length:0;let r="1";for(let s=0;s<t;s++)r+="0";const l=f.afterDot?Number(Number(a).toFixed(f.afterDot)):Number(a);let u=(l*Number(r)-f.step*Number(r))/Number(r);f.min&&u<f.min&&(u=f.min),d.value=x(String(u))}return e({validate:_,validationReset:P,id:f.id}),(a,e)=>{const t=(0,r.up)("InputText");return(0,r.wg)(),(0,r.j4)(u.Z,{id:f.id,label:f.label},{default:(0,r.w5)((()=>[(0,r._)("div",c,[(0,r.Wm)(t,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),id:f.id,class:(0,l.C_)(["w-100",{"p-invalid":b.value}]),placeholder:f.placeholder,disabled:a.disabled,onFocus:e[1]||(e[1]=a=>h(f.id)),onBlur:e[2]||(e[2]=a=>y(f.id))},null,8,["modelValue","id","class","placeholder","disabled"]),(0,r._)("span",m,(0,l.zw)(f.suffix),1)])])),_:1},8,["id","label"])}}});const v=f;var p=v}}]);
//# sourceMappingURL=532.df7613c9.js.map