{"version":3,"file":"js/adminRoles.a223fd35.js","mappings":"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","sources":["webpack://lac/./src/kernel/api/methods/AgentRole.ts","webpack://lac/./src/views/modules/LacRoles/LacRoles.vue?5244","webpack://lac/./src/views/modules/LacRoles/LacRoles.vue","webpack://lac/./src/views/pages/admin/AdminRoles.vue?1f30","webpack://lac/./src/views/pages/admin/AdminRoles.vue"],"sourcesContent":["import { getHttp } from \"@/kernel/api/http\";\r\nimport { ApiResponseType, ApiRequestListOptionsType } from \"@/kernel/api/types\";\r\nimport { NotRequestException } from \"@/kernel/lib/exceptions/not-request.exception\";\r\nimport { RoleAddData } from \"@/kernel/api/dto/AgentRole\";\r\n\r\nexport const getAgentRoleDelete = async (\r\n  role: string\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().get<ApiResponseType | false>(\r\n    \"/agent/role/delete\",\r\n    {\r\n      searchParams: {\r\n        role,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(getAgentRoleDelete.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const getAgentRoleList = async (\r\n  params: ApiRequestListOptionsType = {}\r\n): Promise<ApiResponseType<string[]>> => {\r\n  const res = await getHttp().get<ApiResponseType<string[]> | false>(\r\n    \"/agent/role/list\",\r\n    { searchParams: { ...params, size: 30 } }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(getAgentRoleList.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const postAgentRoleAdd = async (\r\n  payload: RoleAddData\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().post<ApiResponseType | false>(\r\n    \"/agent/role/add\",\r\n    payload\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(postAgentRoleAdd.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const postAgentRoleEdit = async (\r\n  oldRole: string,\r\n  newRole: string\r\n): Promise<ApiResponseType> => {\r\n  const res = await getHttp().post<ApiResponseType | false>(\r\n    \"/agent/role/edit\",\r\n    {\r\n      old_role: oldRole,\r\n      new_role: newRole,\r\n    }\r\n  );\r\n\r\n  if (!res) {\r\n    throw new NotRequestException(postAgentRoleEdit.name);\r\n  }\r\n\r\n  return res;\r\n};\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { resolveComponent as _resolveComponent, mergeProps as _mergeProps, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, Fragment as _Fragment, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-4bfc1eef\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"flex align-items-center justify-content-between pt16 pb16\" }\nconst _hoisted_2 = {\n  class: \"flex align-items-center\",\n  style: {\"font-size\":\"14px\"}\n}\nconst _hoisted_3 = {\n  key: 0,\n  class: \"flex align-items-center\"\n}\n\nimport { nextTick, onMounted, reactive, Ref, ref, watch } from \"vue\";\r\nimport { useStoreModal } from \"@/store/modal\";\r\nimport { AvailableModalsEnum } from \"@/store/modal/types\";\r\nimport { useRouter } from \"vue-router\";\r\nimport {\r\n  getAgentRoleList,\r\n  getAgentRoleDelete,\r\n} from \"@/kernel/api/methods/AgentRole\";\r\nimport { ApiRequestListOptionsType, DIR_TYPES } from \"@/kernel/api/types\";\r\nimport { TableField } from \"@/kernel/entities/types\";\r\nimport LacTable from \"@/views/components/LacTable.vue\";\r\nimport { computed } from \"@vue/reactivity\";\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'LacRoles',\n  setup(__props) {\n\r\nconst router = useRouter();\r\n\r\nconst modals = useStoreModal();\r\n\r\nconst ready = ref(false);\r\n\r\nconst fields = reactive<TableField[]>([\r\n  {\r\n    text: \"Должность\",\r\n    field: \"role\",\r\n    sort: \"role\",\r\n  },\r\n  {\r\n    text: \"\",\r\n    field: \"\",\r\n    sort: \"\",\r\n    noSort: true,\r\n  },\r\n]);\r\n\r\nconst orderField = reactive<{ field?: string; dir?: DIR_TYPES }>({\r\n  field: \"role\",\r\n  dir: DIR_TYPES.ACS,\r\n});\r\n\r\nconst table: Ref<HTMLElement | null> = ref(null);\r\n\r\nconst roles: Ref<string[]> = ref([]);\r\n\r\nconst list = computed(() => {\r\n  return roles.value.map((role) => ({\r\n    role,\r\n    field: \"role\",\r\n  }));\r\n});\r\n\r\nasync function onEdit(role: string) {\r\n  await router.push({ name: \"adminRoleEdit\", params: { role: role } });\r\n}\r\nasync function onDelete(role: string) {\r\n  const callback = async () => {\r\n    try {\r\n      modals.close();\r\n      modals.open(AvailableModalsEnum.LOADER);\r\n      const res = await getAgentRoleDelete(role);\r\n      await loadData();\r\n    } catch (e) {\r\n      modals.open(AvailableModalsEnum.ERROR, {\r\n        text: (e as ErrorEvent).message,\r\n      });\r\n    }\r\n  };\r\n  modals.open(AvailableModalsEnum.CONFIRM, {\r\n    callback,\r\n    text: \"Удалить должность?\",\r\n  });\r\n}\r\n\r\nasync function loadData() {\r\n  modals.open(AvailableModalsEnum.LOADER);\r\n\r\n  const params: ApiRequestListOptionsType = {};\r\n  if (orderField.dir) {\r\n    params.dir = orderField.dir;\r\n  }\r\n  if (orderField.field) {\r\n    params.order = orderField.field;\r\n  }\r\n  const res = await getAgentRoleList(params);\r\n  if (!res.error && res.data.info) {\r\n    roles.value = res.data.info;\r\n    modals.close();\r\n  } else {\r\n    modals.open(AvailableModalsEnum.ERROR);\r\n  }\r\n}\r\n\r\nasync function init() {\r\n  await loadData();\r\n  ready.value = true;\r\n  await nextTick();\r\n}\r\n\r\nwatch(\r\n  () => [orderField.dir, orderField.field],\r\n  () => {\r\n    loadData();\r\n  }\r\n);\r\n\r\nonMounted(init);\r\n\r\nconst sortHandler = (e: any) => {\r\n  orderField.field = e.sortField;\r\n  orderField.dir = e.sortOrder > 0 ? DIR_TYPES.ACS : DIR_TYPES.DESC;\r\n};\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_Button = _resolveComponent(\"Button\")!\n  const _component_RouterLink = _resolveComponent(\"RouterLink\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", {\n    class: \"lac-table-module wrapper\",\n    ref_key: \"table\",\n    ref: table\n  }, [\n    _createElementVNode(\"div\", _hoisted_1, [\n      _createElementVNode(\"div\", _hoisted_2, [\n        _createVNode(_component_RouterLink, _mergeProps({ to: { name: 'adminRoleCreate' } }, _ctx.$props, { custom: \"\" }), {\n          default: _withCtx(({ href, navigate }) => [\n            _createVNode(_component_Button, _mergeProps({\n              onClick: navigate,\n              size: \"small\",\n              label: \"Добавить\"\n            }, _ctx.$attrs, { href: href }), null, 16, [\"onClick\", \"href\"])\n          ]),\n          _: 1\n        }, 16)\n      ])\n    ]),\n    (ready.value)\n      ? (_openBlock(), _createBlock(LacTable, {\n          key: 0,\n          data: _unref(list),\n          style: {\"min-height\":\"0px\"},\n          fields: fields,\n          \"sort-field\": \"role\",\n          \"sort-order\": 1,\n          resizeMode: \"fit\",\n          id: \"roles\",\n          onSort: sortHandler\n        }, {\n          \"column-body\": _withCtx(({ data, field, render }) => [\n            (!field)\n              ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                  _createVNode(_component_Button, {\n                    onClick: ($event: any) => (onEdit(data.role)),\n                    size: \"small\",\n                    icon: \"pi pi-pencil\",\n                    rounded: \"\",\n                    outlined: \"\",\n                    class: \"border-none w-min h-min p-2\",\n                    severity: \"info\"\n                  }, null, 8, [\"onClick\"]),\n                  _createVNode(_component_Button, {\n                    onClick: ($event: any) => (onDelete(data.role)),\n                    size: \"small\",\n                    icon: \"pi pi-trash\",\n                    severity: \"danger\",\n                    rounded: \"\",\n                    outlined: \"\",\n                    class: \"border-none w-min h-min p-2\"\n                  }, null, 8, [\"onClick\"])\n                ]))\n              : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                  _createTextVNode(_toDisplayString(render(data, field)), 1)\n                ], 64))\n          ]),\n          _: 1\n        }, 8, [\"data\", \"fields\"]))\n      : _createCommentVNode(\"\", true)\n  ], 512))\n}\n}\n\n})","import script from \"./LacRoles.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./LacRoles.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./LacRoles.vue?vue&type=style&index=0&id=4bfc1eef&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4bfc1eef\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"overflow-hidden flex flex-column\" }\n\nimport LacRoles from \"@/views/modules/LacRoles/LacRoles.vue\";\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'AdminRoles',\n  setup(__props) {\n\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(LacRoles, { class: \"flex-grow-1\" })\n  ]))\n}\n}\n\n})","import script from \"./AdminRoles.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./AdminRoles.vue?vue&type=script&lang=ts&setup=true\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["getAgentRoleDelete","async","res","getHttp","get","searchParams","role","NotRequestException","name","getAgentRoleList","params","size","postAgentRoleAdd","post","payload","postAgentRoleEdit","oldRole","newRole","old_role","new_role","_hoisted_1","class","_hoisted_2","style","_hoisted_3","key","_defineComponent","__name","setup","__props","router","useRouter","modals","useStoreModal","ready","ref","fields","reactive","text","field","sort","noSort","orderField","dir","DIR_TYPES","ACS","table","roles","list","computed","value","map","onEdit","push","onDelete","callback","close","open","AvailableModalsEnum","LOADER","loadData","e","ERROR","message","CONFIRM","order","error","data","info","init","nextTick","watch","onMounted","sortHandler","sortField","sortOrder","DESC","_ctx","_cache","_component_Button","_resolveComponent","_component_RouterLink","_openBlock","_createElementBlock","ref_key","_createElementVNode","_createVNode","_mergeProps","to","$props","custom","default","_withCtx","href","navigate","onClick","label","$attrs","_","_createBlock","LacTable","_unref","resizeMode","id","onSort","render","_Fragment","_createTextVNode","_toDisplayString","$event","icon","rounded","outlined","severity","_createCommentVNode","__exports__","LacRoles"],"sourceRoot":""}