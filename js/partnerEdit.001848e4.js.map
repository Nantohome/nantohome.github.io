{"version":3,"file":"js/partnerEdit.001848e4.js","mappings":"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","sources":["webpack://lac/./src/kernel/validation/vuelidate/innRules.ts","webpack://lac/./src/views/modules/CrudForms/LacPartnerForm/usePartnerForm.ts","webpack://lac/./src/views/modules/CrudForms/LacPartnerForm/LacEditPartnerForm.vue?7994","webpack://lac/./src/views/modules/CrudForms/LacPartnerForm/LacEditPartnerForm.vue","webpack://lac/./src/views/pages/partner/PartnerEditPage.vue?fc3b","webpack://lac/./src/views/pages/partner/PartnerEditPage.vue"],"sourcesContent":["import {\r\n  helpers,\r\n  maxLength,\r\n  minLength,\r\n  numeric,\r\n  required,\r\n} from \"@vuelidate/validators\";\r\n\r\nexport const innRules = () => ({\r\n  required: helpers.withMessage(\"Это поле обязательно\", required),\r\n  numeric: helpers.withMessage(\"ИНН может состоять только из цифр\", numeric),\r\n  inn: helpers.withMessage(\r\n    \"Длина ИНН должна быть 10 или 12 символов\",\r\n    (value: string) => value.length === 10 || value.length === 12\r\n  ),\r\n});\r\n","import { computed, ComputedRef, reactive, resolveTransitionHooks } from \"vue\";\r\nimport { useStore } from \"@/store\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { ReactiveVariable } from \"vue/macros\";\r\nimport {\r\n  FormFieldProps,\r\n  FormFieldSelectProps,\r\n  LacSelectOption,\r\n} from \"@/views/components/form/types\";\r\nimport { PartnerAddData } from \"@/kernel/api/dto/Partner\";\r\nimport { useFormValidate } from \"@/use/useFormValidate\";\r\nimport { useStorePartner } from \"@/store/partner\";\r\nimport { PartnerType } from \"@/kernel/entities/Partner\";\r\nimport { PhoneForm } from \"@/kernel/entities/types\";\r\nimport { emailRules } from \"@/kernel/validation/vuelidate/emailRules\";\r\nimport { maxLengthRules } from \"@/kernel/validation/vuelidate/maxLengthRules\";\r\nimport { phoneObjRules } from \"@/kernel/validation/vuelidate/phoneObjRules\";\r\nimport { requiredRules } from \"@/kernel/validation/vuelidate/requiredRules\";\r\nimport { innRules } from \"@/kernel/validation/vuelidate/innRules\";\r\nimport { useRouter, useRoute } from \"vue-router\";\r\n\r\nexport const usePartnerForm = () => {\r\n  const router = useRouter();\r\n  const route = useRoute();\r\n  const partner_id = parseInt(route.params.id as string);\r\n  const { setFieldRef, validateForm, resetValidations } = useFormValidate();\r\n  const storePartner = useStorePartner();\r\n  const { partners } = storeToRefs(storePartner);\r\n\r\n  const { dictionary } = storeToRefs(useStore());\r\n\r\n  const partnerTypes: ComputedRef<PartnerType[]> = computed(() => {\r\n    const dictPartnerType = dictionary.value\r\n      ? dictionary.value.partner.type\r\n      : {};\r\n\r\n    return Object.keys(dictPartnerType).map((key) =>\r\n      storePartner.createPartnerType(key)\r\n    );\r\n  });\r\n\r\n  const partnerType: ReactiveVariable<FormFieldSelectProps<PartnerType>> =\r\n    reactive({\r\n      value: null,\r\n      id: \"type\",\r\n      label: \"Тип\",\r\n      items: partnerTypes,\r\n      rules: requiredRules(),\r\n    });\r\n\r\n  const partnerPhone: ReactiveVariable<PhoneForm[]> = reactive([]);\r\n\r\n  const fields: ReactiveVariable<Record<string, FormFieldProps>> = reactive({\r\n    inn: {\r\n      value: \"\",\r\n      id: \"inn\",\r\n      label: \"ИНН\",\r\n      rules: innRules(),\r\n    },\r\n    fullname: {\r\n      value: \"\",\r\n      id: \"fullname\",\r\n      label: \"Полное наименование\",\r\n      rules: requiredRules(),\r\n    },\r\n    name: {\r\n      value: \"\",\r\n      id: \"name\",\r\n      label: \"Краткое наименование\",\r\n      rules: requiredRules(),\r\n    },\r\n    website: {\r\n      value: \"\",\r\n      id: \"website\",\r\n      label: \"Сайт\",\r\n    },\r\n    email: {\r\n      value: \"\",\r\n      id: \"email\",\r\n      label: \"E-mail\",\r\n      rules: emailRules(),\r\n    },\r\n    comment: {\r\n      value: \"\",\r\n      id: \"comment\",\r\n      rules: maxLengthRules(),\r\n    },\r\n  });\r\n\r\n  function addPartnerPhone(phone?: PhoneForm[]) {\r\n    if (phone) {\r\n      for (const p of phone) {\r\n        partnerPhone.push({\r\n          phone: p.phone,\r\n          type: p.type,\r\n          extra: p.extra,\r\n          typeDisabled: true,\r\n        });\r\n      }\r\n    } else {\r\n      partnerPhone.push({\r\n        phone: \"\",\r\n        type: { value: \"work\", text: dictionary.value.phone.type[\"work\"] },\r\n        extra: \"\",\r\n        typeDisabled: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  function removePartnerPhone(index: number) {\r\n    if (partnerPhone.length > 1) {\r\n      partnerPhone.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  function prepareData(): any {\r\n    const res: Record<string, any> = {};\r\n\r\n    Object.entries(fields).forEach(([key, value]) => {\r\n      if (value.value) {\r\n        res[key] = value.value;\r\n      }\r\n    });\r\n\r\n    res.phone = [];\r\n    for (const phone of partnerPhone) {\r\n      if (phone.phone && phone.type.value) {\r\n        res.phone.push(phone);\r\n      }\r\n    }\r\n\r\n    res.type = partnerType.value\r\n      ? (partnerType.value as LacSelectOption).value\r\n      : \"\";\r\n\r\n    return res as any;\r\n  }\r\n\r\n  function clear() {\r\n    Object.values(fields).forEach((el) => (el.value = \"\"));\r\n    partnerType.value = null;\r\n    resetValidations();\r\n  }\r\n\r\n  function successCallback(variant: string) {\r\n    clear();\r\n    router.back();\r\n  }\r\n\r\n  async function fillFromSelectedPartner() {\r\n    if (partners.value[partner_id] === undefined) {\r\n      await storePartner.fetch(partner_id);\r\n    }\r\n\r\n    partnerType.value =\r\n      partnerTypes.value.find(\r\n        (el) => el.value === partners.value[partner_id].type.value\r\n      ) || null;\r\n\r\n    addPartnerPhone(partners.value[partner_id].phone);\r\n\r\n    fields.fullname.value = partners.value[partner_id].fullname;\r\n    fields.inn.value = partners.value[partner_id].inn;\r\n    fields.name.value = partners.value[partner_id].name;\r\n    fields.website.value = partners.value[partner_id].website || \"\";\r\n    fields.email.value = partners.value[partner_id].email || \"\";\r\n    fields.comment.value = partners.value[partner_id].comment || \"\";\r\n  }\r\n\r\n  async function editPartner() {\r\n    await storePartner.edit(prepareData(), partner_id);\r\n  }\r\n\r\n  return {\r\n    partnerType,\r\n    partnerPhone,\r\n    fields,\r\n    successCallback,\r\n    prepareData,\r\n    setFieldRef,\r\n    validateForm,\r\n    editPartner,\r\n    fillFromSelectedPartner,\r\n    addPartnerPhone,\r\n    removePartnerPhone,\r\n  };\r\n};\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, createVNode as _createVNode, withCtx as _withCtx, resolveComponent as _resolveComponent, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = [\"onSubmit\"]\n\nimport { onMounted } from \"vue\";\r\nimport LacFieldset from \"@/views/components/form/field/LacFieldset.vue\";\r\nimport LacInputText from \"@/views/components/form/input/LacInputText.vue\";\r\nimport LacTextarea from \"@/views/components/form/input/LacTextarea.vue\";\r\nimport LacSelect from \"@/views/components/form/select/LacSelect.vue\";\r\nimport LacPhone from \"@/views/components/form/input/LacPhone.vue\";\r\n\r\nimport { useStorePartner } from \"@/store/partner\";\r\nimport { useStoreModal } from \"@/store/modal\";\r\nimport { AvailableModalsEnum } from \"@/store/modal/types\";\r\nimport { usePartnerForm } from \"@/views/modules/CrudForms/LacPartnerForm/usePartnerForm\";\r\nimport { useFieldsetCols } from \"@/views/components/form/field/useFieldsetCols\";\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'LacEditPartnerForm',\n  setup(__props) {\n\r\nconst { computedCols } = useFieldsetCols();\r\nconst {\r\n  fields,\r\n  partnerType,\r\n  partnerPhone,\r\n  setFieldRef,\r\n  successCallback,\r\n  validateForm,\r\n  addPartnerPhone,\r\n  removePartnerPhone,\r\n  editPartner,\r\n  fillFromSelectedPartner,\r\n} = usePartnerForm();\r\n\r\nconst partnerState = useStorePartner();\r\nconst modals = useStoreModal();\r\n\r\nasync function onSubmit(): Promise<void> {\r\n  const isValid = await validateForm();\r\n  if (isValid) {\r\n    try {\r\n      modals.open(AvailableModalsEnum.LOADER);\r\n      await editPartner();\r\n      modals.open(AvailableModalsEnum.SUCCESS, { callback: successCallback });\r\n    } catch (e) {\r\n      modals.open(AvailableModalsEnum.ERROR, {\r\n        text: (e as ErrorEvent).message,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await fillFromSelectedPartner();\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_Button = _resolveComponent(\"Button\")!\n\n  return (_openBlock(), _createElementBlock(\"form\", {\n    class: \"lac-form lac-create-partner-form\",\n    onSubmit: _withModifiers(onSubmit, [\"prevent\"])\n  }, [\n    _createVNode(LacFieldset, {\n      title: \"Общие параметры\",\n      class: \"mb16 lac-fieldset-params\",\n      grid: _unref(computedCols)\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).fullname.value,\n          \"onUpdate:value\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(fields).fullname.value) = $event)),\n          id: _unref(fields).fullname.id,\n          label: _unref(fields).fullname.label,\n          rules: _unref(fields).fullname.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacSelect, {\n          variant: \"horizontal\",\n          value: _unref(partnerType).value,\n          \"onUpdate:value\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(partnerType).value) = $event)),\n          items: _unref(partnerType).items,\n          id: _unref(partnerType).id,\n          label: _unref(partnerType).label,\n          rules: _unref(partnerType).rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"items\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).name.value,\n          \"onUpdate:value\": _cache[2] || (_cache[2] = ($event: any) => ((_unref(fields).name.value) = $event)),\n          id: _unref(fields).name.id,\n          label: _unref(fields).name.label,\n          rules: _unref(fields).name.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).inn.value,\n          \"onUpdate:value\": _cache[3] || (_cache[3] = ($event: any) => ((_unref(fields).inn.value) = $event)),\n          id: _unref(fields).inn.id,\n          label: _unref(fields).inn.label,\n          rules: _unref(fields).inn.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"])\n      ]),\n      _: 1\n    }, 8, [\"grid\"]),\n    _createVNode(LacFieldset, {\n      title: \"Контакты\",\n      class: \"mb16 lac-fieldset-contacts\"\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).website.value,\n          \"onUpdate:value\": _cache[4] || (_cache[4] = ($event: any) => ((_unref(fields).website.value) = $event)),\n          id: _unref(fields).website.id,\n          label: _unref(fields).website.label,\n          placeholder: \"\",\n          ref: _unref(setFieldRef),\n          class: \"lac-fieldset-contacts-website\"\n        }, null, 8, [\"value\", \"id\", \"label\"]),\n        _createVNode(LacInputText, {\n          variant: \"horizontal\",\n          value: _unref(fields).email.value,\n          \"onUpdate:value\": _cache[5] || (_cache[5] = ($event: any) => ((_unref(fields).email.value) = $event)),\n          id: _unref(fields).email.id,\n          label: _unref(fields).email.label,\n          rules: _unref(fields).email.rules,\n          placeholder: \"\",\n          class: \"lac-fieldset-contacts-email\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"label\", \"rules\"]),\n        _createVNode(LacPhone, {\n          value: _unref(partnerPhone),\n          onAdd: _unref(addPartnerPhone),\n          onRemove: _unref(removePartnerPhone)\n        }, null, 8, [\"value\", \"onAdd\", \"onRemove\"])\n      ]),\n      _: 1\n    }),\n    _createVNode(LacFieldset, {\n      title: \"Комментарий\",\n      class: \"mb8\"\n    }, {\n      default: _withCtx(() => [\n        _createVNode(LacTextarea, {\n          \"no-resize\": \"\",\n          rows: 3,\n          value: _unref(fields).comment.value,\n          \"onUpdate:value\": _cache[6] || (_cache[6] = ($event: any) => ((_unref(fields).comment.value) = $event)),\n          id: _unref(fields).comment.id,\n          rules: _unref(fields).comment.rules,\n          placeholder: \"\",\n          ref: _unref(setFieldRef)\n        }, null, 8, [\"value\", \"id\", \"rules\"])\n      ]),\n      _: 1\n    }),\n    _createVNode(_component_Button, {\n      type: \"submit\",\n      label: \"Сохранить\"\n    })\n  ], 40, _hoisted_1))\n}\n}\n\n})","import script from \"./LacEditPartnerForm.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./LacEditPartnerForm.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./LacEditPartnerForm.vue?vue&type=style&index=0&id=00e882a8&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue'\nimport { openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, withCtx as _withCtx } from \"vue\"\n\nimport FormTemplate from \"@/views/templates/FormTemplate/FormTemplate.vue\";\r\nimport LacEditPartnerForm from \"@/views/modules/CrudForms/LacPartnerForm/LacEditPartnerForm.vue\";\r\nimport { onBeforeMount, ref } from \"vue\";\r\nimport { useStorePartner } from \"@/store/partner\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport { getPartnerGet } from \"@/kernel/api/methods/getPartnerGet\";\r\nimport { PartnerEntity } from \"@/kernel/entities/PartnerEntity\";\r\nimport { useStoreModal } from \"@/store/modal\";\r\nimport { AvailableModalsEnum } from \"@/store/modal/types\";\r\nimport { isEmptyObject } from \"@/kernel/lib/isEmptyObject\";\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'PartnerEditPage',\n  setup(__props) {\n\r\nconst storePartner = useStorePartner();\r\nconst { selectPartnerId, partners } = storeToRefs(storePartner);\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst modals = useStoreModal();\r\nconst isReady = ref(false);\r\n\r\nconst partnerId = parseInt(route.params.id as string);\r\n\r\nasync function goBack() {\r\n  modals.close();\r\n  await router.back();\r\n}\r\n\r\nasync function fetchPartner() {\r\n  if (partners.value[partnerId] === undefined) {\r\n    const isError = await storePartner.fetch(partnerId);\r\n\r\n    if (isError) {\r\n      await router.replace({ name: \"map\" });\r\n      return;\r\n    }\r\n  }\r\n}\r\n\r\nconst strategies = {\r\n  ok: () => {\r\n    isReady.value = true;\r\n    modals.close();\r\n  },\r\n  partnerIdNotFetched: async () => {\r\n    await fetchPartner();\r\n    isReady.value = true;\r\n    modals.close();\r\n  },\r\n  partnerIdNotFound: async () => {\r\n    await goBack();\r\n  },\r\n  partnerIdNotFoundAndSelectPartnerNotFound: async () => {\r\n    await goBack();\r\n  },\r\n};\r\n\r\nonBeforeMount(async () => {\r\n  try {\r\n    modals.open(AvailableModalsEnum.LOADER);\r\n\r\n    if (!partnerId) {\r\n      await strategies.partnerIdNotFound();\r\n      return;\r\n    } else if (!selectPartnerId.value) {\r\n      await strategies.partnerIdNotFetched();\r\n      return;\r\n    } else {\r\n      strategies.ok();\r\n      return;\r\n    }\r\n  } catch (e) {\r\n    await strategies.partnerIdNotFoundAndSelectPartnerNotFound();\r\n  }\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createBlock(FormTemplate, { title: \"Редактирование контрагента\" }, {\n    default: _withCtx(() => [\n      (isReady.value)\n        ? (_openBlock(), _createBlock(LacEditPartnerForm, { key: 0 }))\n        : _createCommentVNode(\"\", true)\n    ]),\n    _: 1\n  }))\n}\n}\n\n})","import script from \"./PartnerEditPage.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./PartnerEditPage.vue?vue&type=script&lang=ts&setup=true\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["innRules","required","helpers","withMessage","numeric","inn","value","length","usePartnerForm","router","useRouter","route","useRoute","partner_id","parseInt","params","id","setFieldRef","validateForm","resetValidations","useFormValidate","storePartner","useStorePartner","partners","storeToRefs","dictionary","useStore","partnerTypes","computed","dictPartnerType","partner","type","Object","keys","map","key","createPartnerType","partnerType","reactive","label","items","rules","requiredRules","partnerPhone","fields","fullname","name","website","email","emailRules","comment","maxLengthRules","addPartnerPhone","phone","p","push","extra","typeDisabled","text","removePartnerPhone","index","splice","prepareData","res","entries","forEach","clear","values","el","successCallback","variant","back","async","fillFromSelectedPartner","undefined","fetch","find","editPartner","edit","_hoisted_1","_defineComponent","__name","setup","__props","computedCols","useFieldsetCols","modals","useStoreModal","onSubmit","isValid","open","AvailableModalsEnum","LOADER","SUCCESS","callback","e","ERROR","message","onMounted","_ctx","_cache","_component_Button","_resolveComponent","_openBlock","_createElementBlock","class","_withModifiers","_createVNode","LacFieldset","title","grid","_unref","default","_withCtx","LacInputText","$event","placeholder","ref","LacSelect","_","LacPhone","onAdd","onRemove","LacTextarea","rows","__exports__","selectPartnerId","isReady","partnerId","goBack","close","fetchPartner","isError","replace","strategies","ok","partnerIdNotFetched","partnerIdNotFound","partnerIdNotFoundAndSelectPartnerNotFound","onBeforeMount","_createBlock","FormTemplate","LacEditPartnerForm","_createCommentVNode"],"sourceRoot":""}