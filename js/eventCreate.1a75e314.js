"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[773],{7273:function(e,a,t){t.d(a,{B2:function(){return d},Mq:function(){return s},Xy:function(){return i},ax:function(){return u},o$:function(){return r}});var l=t(7542),n=t(8020);const r=async e=>{const a=await(0,l.I)().get("/event/get",{searchParams:{event_id:e}});if(!a)throw new n.u(r.name);return a},u=async e=>{const a=await(0,l.I)().get("/event/delete",{searchParams:{event_id:e}});if(!a)throw new n.u(u.name);return a},i=async e=>{const a=await(0,l.I)().get("/event/list",{searchParams:{...e}});if(!a)throw new n.u(i.name);return a},s=async e=>{const a=await(0,l.I)().post("/event/add",e);if(!a)throw new n.u(s.name);return a},d=async e=>{const a=await(0,l.I)().post("/event/edit",e);if(!a)throw new n.u(d.name);return a}},1712:function(e,a,t){t.d(a,{j:function(){return s}});var l=t(4870),n=t(6945),r=t(1020),u=t(4008),i=t(5845);const s=()=>{const{dictionary:e}=(0,r.Jk)((0,i.o)()),a=(0,l.qj)({planned_date:{value:"",id:"planned_date",label:"Плановая дата",rules:(0,n.v)()},planned_time:{value:"",id:"planned_time",label:"Плановое время",rules:(0,n.v)()},fact_date:{value:"",id:"fact_date",label:"Фактическая дата",rules:(0,n.v)()},fact_time:{value:"",id:"fact_time",label:"Фактическое время",rules:(0,n.v)()},type:{value:null,id:"role",label:"Тип",items:Object.entries(e.value.event.type).map((([e,a])=>({value:e,text:a}))),rules:(0,n.v)()},agent:{value:null,id:"agent",label:"Сотрудник",items:[],rules:(0,n.v)()},partner:{value:null,id:"partner",label:"Контрагент",items:[],rules:(0,n.v)()},comment:{id:"comment",label:"Комментарий",value:"",rules:(0,u.F)()}});return{fields:a}}},5211:function(e,a,t){t.d(a,{I:function(){return l}});const l=e=>{function a(){const a=new Date(e.planned_date.value),t=e.planned_time.value.split(":").map((e=>Number(e)));a.setHours(t[0],t[1]);const l=e.fact_date.value?new Date(e.fact_date.value):null;if(l){const a=e.fact_time.value.split(":").map((e=>Number(e)));l.setHours(a[0],a[1])}const n=e.agent.value?Number(e.agent.value.value):0,r=e.type.value?e.type.value.value:"",u={planned_time:a.getTime()/1e3,agent_id:n||9,type:r};return l&&(u.actual_time=l.getTime()/1e3),e.comment.value&&(u.comment=e.comment.value),u}return{prepareData:a}}},890:function(e,a,t){t.d(a,{S:function(){return r}});var l=t(9286),n=t(3856);const r=()=>{const e=(0,l.N)();function a(a){return async()=>{try{e.open(n.y.LOADER),await a(),e.close()}catch(t){e.open(n.y.ERROR,{text:t.message})}}}return{initTemplate:a}}},354:function(e,a,t){t.d(a,{e:function(){return u}});var l=t(9286),n=t(3856),r=t(2483);const u=e=>{const a=(0,l.N)(),t=(0,r.tv)();function u(l,r){return async()=>{if(await e())try{a.open(n.y.LOADER),await l(),!r&&a.open(n.y.SUCCESS,{callback:()=>t.back()})}catch(u){a.open(n.y.ERROR,{text:u.message})}}}return{submitTemplate:u}}},6144:function(e,a,t){t.d(a,{Z:function(){return o}});var l=t(3396),n=t(7139),r=t(5838),u=t(4870),i=t(4219),s=t(3435),d=(0,l.aZ)({__name:"LacInputText",props:{label:{},placeholder:{},id:{},value:{},icon:{},rules:{},type:{},labelPosition:{},disabled:{type:Boolean}},emits:["update:value"],setup(e,{expose:a,emit:t}){const d=e,v=(0,s.p)(),o=((0,u.iH)(!1),(0,i.ZP)({props:{value:d.rules||{}}},{props:d})),c=(0,l.Fl)((()=>!!o.value.$errors.length)),p=(0,l.Fl)({get(){return d.value},set(e){t("update:value",e)}});async function m(){const e=await o.value.$validate();return e||v.add({severity:"error",summary:d.label,detail:o.value.$errors[0].$message}),e}function b(){o.value.$reset()}return a({validate:m,validationReset:b,id:d.id}),(e,a)=>{const t=(0,l.up)("InputText");return(0,l.wg)(),(0,l.j4)(r.Z,{id:d.id,label:d.label,labelPosition:d.labelPosition},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),id:d.id,placeholder:d.placeholder,type:e.type?e.type:"text",disabled:e.disabled,class:(0,n.C_)(["w-full",{"p-invalid":c.value}]),onBlur:a[1]||(a[1]=a=>e.$emit("blur",e.event))},null,8,["modelValue","id","placeholder","type","disabled","class"])])),_:1},8,["id","label","labelPosition"])}}});const v=d;var o=v},8447:function(e,a,t){t.r(a),t.d(a,{default:function(){return x}});var l=t(3396),n=t(2793),r=t(4870),u=t(9242),i=t(140),s=t(9546),d=t(7174),v=t(6144),o=t(1411),c=t(4436),p=t(1735),m=t(354),b=t(890),S=t(1712),U=t(9358),f=t(5211),y=t(7273),_=t(1020),g=t(9152),w=t(6646);const h=()=>{const{setFieldRef:e,validateForm:a,resetValidations:t}=(0,p.Z)(),l=(0,r.iH)(!1),n=(0,w.F)(),u=(0,g.N)(),{fields:i}=(0,S.j)(),{agents:s}=(0,_.Jk)(n),{selectPartnerId:d}=(0,_.Jk)(u),{prepareData:v}=(0,f.I)(i),{submitTemplate:o}=(0,m.e)(a),{initTemplate:c}=(0,b.S)(),{updateAgent:h,updatePartner:Z}=(0,U.P)(l);async function I(){let e;await Z(i.partner),i.partner.value?.value&&(e=parseInt(i.partner.value.value)),await h(i.agent,e),l.value=!0}async function P(){const e=v(),a=await(0,y.Mq)(e);if(a.error)throw new Error(a.data.info?JSON.stringify(a.data.info,null,2):"Не удалось добавить событие")}return{setFieldRef:e,validateForm:a,resetValidations:t,fields:i,init:c(I),submit:o(P),isInit:l}};var Z=t(5623),I=t(9286);const P=["onSubmit"];var W=(0,l.aZ)({__name:"LacEventCreateForm",setup(e){(0,g.N)(),(0,I.N)();const{setFieldRef:a,validateForm:t,resetValidations:n,fields:p,init:m,isInit:b,submit:S}=h(),{updateAgent:f}=(0,U.P)(b),{onSelectSearch:y}=(0,Z.z)(b),{fieldVariant:_}=(0,c.U)(),{computedCols:w}=(0,o.b)();async function W(){await S()}return(0,l.bv)((async()=>{await m()})),(0,l.YP)((()=>p.partner.value?.value),(async e=>{if(b.value){const a=e?parseInt(e):void 0;await f(p.agent,a)}})),(e,t)=>{const n=(0,l.up)("Button");return(0,r.SU)(b)?((0,l.wg)(),(0,l.iD)("form",{key:0,class:"lac-form",onSubmit:(0,u.iM)(W,["prevent"])},[(0,l.Wm)(i.Z,{title:"Общие параметры",class:"mb16",grid:(0,r.SU)(w)},{default:(0,l.w5)((()=>[(0,l.Wm)(d.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).partner.value,"onUpdate:value":t[0]||(t[0]=e=>(0,r.SU)(p).partner.value=e),items:(0,r.SU)(p).partner.items,id:(0,r.SU)(p).partner.id,label:(0,r.SU)(p).partner.label,placeholder:"",searchable:"","show-clear":"","clear-on-close":"",onSearch:t[1]||(t[1]=e=>(0,r.SU)(y)(e,(0,r.SU)(p).partner)),ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).partner.available,rules:(0,r.SU)(p).partner.rules},null,8,["variant","value","items","id","label","disabled","rules"]),(0,l.Wm)(d.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).agent.value,"onUpdate:value":t[2]||(t[2]=e=>(0,r.SU)(p).agent.value=e),items:(0,r.SU)(p).agent.items,id:(0,r.SU)(p).agent.id,label:(0,r.SU)(p).agent.label,placeholder:"",ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).partner.value||!(0,r.SU)(p).agent.available,rules:(0,r.SU)(p).agent.rules},null,8,["variant","value","items","id","label","disabled","rules"]),(0,l.Wm)(v.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).planned_date.value,"onUpdate:value":t[3]||(t[3]=e=>(0,r.SU)(p).planned_date.value=e),id:(0,r.SU)(p).planned_date.id,label:(0,r.SU)(p).planned_date.label,rules:(0,r.SU)(p).planned_date.rules,type:"date",ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).agent.value||!(0,r.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(v.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).planned_time.value,"onUpdate:value":t[4]||(t[4]=e=>(0,r.SU)(p).planned_time.value=e),id:(0,r.SU)(p).planned_time.id,label:(0,r.SU)(p).planned_time.label,rules:(0,r.SU)(p).planned_time.rules,type:"time",ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).agent.value||!(0,r.SU)(p).agent.value.value},null,8,["variant","value","id","label","rules","disabled"]),(0,l.Wm)(v.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).fact_date.value,id:(0,r.SU)(p).fact_date.id,label:(0,r.SU)(p).fact_date.label,rules:(0,r.SU)(p).fact_date.rules,type:"date",disabled:""},null,8,["variant","value","id","label","rules"]),(0,l.Wm)(v.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).fact_time.value,id:(0,r.SU)(p).fact_time.id,label:(0,r.SU)(p).fact_time.label,rules:(0,r.SU)(p).fact_time.rules,type:"time",disabled:""},null,8,["variant","value","id","label","rules"]),(0,l.Wm)(d.Z,{variant:(0,r.SU)(_),value:(0,r.SU)(p).type.value,"onUpdate:value":t[5]||(t[5]=e=>(0,r.SU)(p).type.value=e),items:(0,r.SU)(p).type.items,id:(0,r.SU)(p).type.id,label:(0,r.SU)(p).type.label,placeholder:"",ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).agent.value||!(0,r.SU)(p).agent.value.value,rules:(0,r.SU)(p).type.rules},null,8,["variant","value","items","id","label","disabled","rules"])])),_:1},8,["grid"]),(0,l.Wm)(i.Z,{class:"mb8",grid:(0,r.SU)(w)},null,8,["grid"]),(0,l.Wm)(i.Z,{title:"Комментарий",class:"mb8"},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,{"no-resize":"",rows:3,value:(0,r.SU)(p).comment.value,"onUpdate:value":t[6]||(t[6]=e=>(0,r.SU)(p).comment.value=e),id:(0,r.SU)(p).comment.id,rules:(0,r.SU)(p).comment.rules,ref:(0,r.SU)(a),disabled:!(0,r.SU)(p).agent.value||!(0,r.SU)(p).agent.value.value},null,8,["value","id","rules","disabled"])])),_:1}),(0,l.Wm)(n,{label:"Добавить",type:"submit"})],40,P)):(0,l.kq)("",!0)}}});const R=W;var k=R,F=(0,l.aZ)({__name:"EventCreatePage",setup(e){return(e,a)=>((0,l.wg)(),(0,l.j4)(n.Z,{title:"Добавление события"},{default:(0,l.w5)((()=>[(0,l.Wm)(k)])),_:1}))}});const N=F;var x=N}}]);
//# sourceMappingURL=eventCreate.1a75e314.js.map