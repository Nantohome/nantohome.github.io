"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[136],{7273:function(e,t,n){n.d(t,{B2:function(){return c},Mq:function(){return s},Xy:function(){return o},ax:function(){return r},o$:function(){return l}});var a=n(7542),i=n(8020);const l=async e=>{const t=await(0,a.I)().get("/event/get",{searchParams:{event_id:e}});if(!t)throw new i.u(l.name);return t},r=async e=>{const t=await(0,a.I)().get("/event/delete",{searchParams:{event_id:e}});if(!t)throw new i.u(r.name);return t},o=async e=>{const t=await(0,a.I)().get("/event/list",{searchParams:{...e}});if(!t)throw new i.u(o.name);return t},s=async e=>{const t=await(0,a.I)().post("/event/add",e);if(!t)throw new i.u(s.name);return t},c=async e=>{const t=await(0,a.I)().post("/event/edit",e);if(!t)throw new i.u(c.name);return t}},5430:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(3396),i=n(4870),l=n(7139);const r={key:0,class:"lac-pagination"};var o=(0,a.aZ)({__name:"LacPagination",props:{pageSize:{default:10},total:{default:10},page:{default:0}},emits:["update:page"],setup(e,{expose:t,emit:n}){const o=e,s=(0,i.Fl)((()=>Math.ceil(o.total/o.pageSize))),c=()=>{o.page>=o.total||n("update:page",o.page+1)},u=()=>{o.page<=0||n("update:page",o.page-1)};return(0,a.YP)((()=>o.total),(()=>{})),t({next:c,prev:u}),(e,t)=>{const n=(0,a.up)("Button");return(0,i.SU)(s)>0?((0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)(n,{icon:"pi pi-arrow-left",disabled:!e.page,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:u},null,8,["disabled"]),(0,a.Uk)(" "+(0,l.zw)(e.page+1)+"/"+(0,l.zw)((0,i.SU)(s))+" ",1),(0,a.Wm)(n,{icon:"pi pi-arrow-right",disabled:e.page===(0,i.SU)(s)-1,rounded:"",outlined:"",text:"",severity:"info",title:"назад",class:"border-none h-min w-min p-2",onClick:c},null,8,["disabled"])])):(0,a.kq)("",!0)}}}),s=n(89);const c=(0,s.Z)(o,[["__scopeId","data-v-876429e4"]]);var u=c},5990:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var a=n(3396),i=(n(7658),n(7139)),l=n(4870),r=n(9152),o=n(1020),s=n(9286),c=n(3856),u=n(1839),d=n(7273),p=n(5845),f=n(258),v=n(5430),m=n(6408),g=n(3917);const w={class:"flex align-items-center justify-content-between pt16 pb16"},y={class:"flex align-items-center",style:{"font-size":"14px"}},_={class:"flex align-items-center"},k={key:4,class:"flex align-items-center"};var h=(0,a.aZ)({__name:"LacEvents",setup(e){const{dictionary:t}=(0,p.o)(),n=(0,r.N)(),h=(0,f.S)(),x=(0,p.o)(),{selectPartnerId:b}=(0,o.Jk)(n),{selectUserId:z}=(0,o.Jk)(h),{config:C}=(0,o.Jk)(x),D=(0,s.N)(),S=(0,l.iH)(!1),H=(0,l.qj)([{text:"Плановая дата",field:"planned_time",sort:"planned_time"},{text:"Фактическая дата",field:"actual_time",sort:"actual_time"},{text:"Тип",field:"type",sort:"type"},{text:"Сотрудник",field:"agent.name",sort:"agent.name"},{text:"Комментарий",field:"comment",sort:"comment"},{text:"",field:"",sort:"",noSort:!0}]),U=(0,l.qj)({field:"planned_time",dir:m.O.DESC}),I=(0,l.iH)([]),E=(0,l.iH)(null),O=(0,l.iH)(0),Y=C.value.pagination?.event?.per_page||10,Z=(0,l.iH)(Y),P=(0,l.iH)(0);function W(e,t=!1){const n=new Date(e),a=n.getDate(),i=n.getMonth()+1;let l=`${a>=10?a:"0"+a}.${i>=10?i:"0"+i}.${n.getFullYear()}`;if(t){const e=n.getHours(),t=n.getMinutes();l+=`, ${e>=10?e:"0"+e}:${t>=10?t:"0"+t}`}return l}async function $(e){await u.Z.push({name:"eventEdit",params:{id:e}})}async function R(e){const t=async()=>{try{D.open(c.y.LOADER);const t=await(0,d.ax)(e);if(t.error)throw new Error(JSON.stringify(t.data.info)||"Что то пошло не так");const n=I.value.findIndex((t=>t.event_id===e));-1!==n&&(I.value.splice(n,1),P.value--),D.close()}catch(t){D.open(c.y.ERROR,{text:t.message})}};D.open(c.y.CONFIRM,{callback:t,text:"Удалить событие?"})}async function M(){D.open(c.y.LOADER);const e={};e.page=O.value,b.value&&(e.partner_id=b.value),z.value&&(e.user_id=z.value),U.dir&&(e.dir=U.dir),U.field&&(e.order=U.field),Z.value&&(e.size=Z.value);const t=await(0,d.Xy)(e);!t.error&&t.data.info&&(I.value=t.data.info,P.value=t.data.count||0),D.close()}async function q(){await M(),S.value=!0,await(0,a.Y3)()}(0,a.YP)((()=>[z.value,b.value,O.value,U.dir,U.field]),((e,t)=>{e[0]===t[0]&&e[1]===t[1]||(O.value=0),M()})),(0,a.bv)(q);const L=e=>{U.field=e.sortField,U.dir=e.sortOrder>0?m.O.ACS:m.O.DESC};return(e,n)=>{const r=(0,a.up)("Button"),o=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.iD)("div",{class:"lac-table-module wrapper",ref_key:"table",ref:E},[(0,a._)("div",w,[(0,a._)("div",y,[(0,a.Wm)(o,(0,a.dG)({to:{name:"eventCreate"}},e.$props,{custom:""}),{default:(0,a.w5)((({href:t,navigate:n})=>[(0,a.Wm)(r,(0,a.dG)({onClick:n,size:"small",label:"Добавить"},e.$attrs,{href:t}),null,16,["onClick","href"])])),_:1},16)]),(0,a._)("div",_,[(0,a.Wm)(v.Z,{page:O.value,"onUpdate:page":n[0]||(n[0]=e=>O.value=e),total:P.value,"page-size":Z.value},null,8,["page","total","page-size"])])]),S.value?((0,a.wg)(),(0,a.j4)(g.Z,{key:0,data:I.value,style:{"min-height":"0px"},fields:H,"sort-field":"planned_time","sort-order":-1,resizeMode:"fit",id:"events",onSort:L},{"column-body":(0,a.w5)((({data:e,field:n,render:o})=>["planned_time"===n?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)((0,i.zw)(W(1e3*e.planned_time,!0)),1)],64)):"actual_time"===n?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,i.zw)(e.actual_time?W(1e3*e.actual_time,!0):""),1)],64)):"type"===n?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[(0,a.Uk)((0,i.zw)((0,l.SU)(t).event.type[e.type]),1)],64)):"agent.name"===n?((0,a.wg)(),(0,a.iD)(a.HY,{key:3},[(0,a.Uk)((0,i.zw)(e.agent?.name),1)],64)):n?((0,a.wg)(),(0,a.iD)(a.HY,{key:5},[(0,a.Uk)((0,i.zw)(o(e,n)),1)],64)):((0,a.wg)(),(0,a.iD)("div",k,[(0,a.Wm)(r,{onClick:t=>$(e.event_id),size:"small",icon:"pi pi-pencil",rounded:"",outlined:"",class:"border-none w-min h-min p-2",severity:"info"},null,8,["onClick"]),(0,a.Wm)(r,{onClick:t=>R(e.event_id),size:"small",icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",class:"border-none w-min h-min p-2"},null,8,["onClick"])]))])),_:1},8,["data","fields"])):(0,a.kq)("",!0)],512)}}}),x=n(89);const b=(0,x.Z)(h,[["__scopeId","data-v-6a0fa931"]]);var z=b;const C={class:"overflow-hidden flex flex-column"};var D=(0,a.aZ)({__name:"EventsPage",setup(e){return(e,t)=>((0,a.wg)(),(0,a.iD)("div",C,[(0,a.Wm)(z,{class:"flex-grow-1"})]))}});const S=D;var H=S}}]);
//# sourceMappingURL=events.f9b39ade.js.map