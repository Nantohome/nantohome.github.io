"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[526],{7229:function(e,a,l){l.d(a,{d:function(){return f}});l(7658);var t=l(3396),n=l(4870),u=l(5845),r=l(1020),i=l(1735),o=l(9152),s=l(6342),c=l(4008),v=l(6945),d=l(5420);const m=()=>({required:d.BM.withMessage("Это поле обязательно",d.C1),numeric:d.BM.withMessage("ИНН может состоять только из цифр",d.uR),inn:d.BM.withMessage("Длина ИНН должна быть 10 или 12 символов",(e=>10===e.length||12===e.length))});var p=l(2483);const f=()=>{const e=(0,p.tv)(),a=(0,p.yj)(),l=parseInt(a.params.id),{setFieldRef:d,validateForm:f,resetValidations:b}=(0,i.Z)(),S=(0,o.N)(),{partners:U}=(0,r.Jk)(S),{dictionary:h}=(0,r.Jk)((0,u.o)()),w=(0,t.Fl)((()=>{const e=h.value?h.value.partner.type:{};return Object.keys(e).map((e=>S.createPartnerType(e)))})),y=(0,n.qj)({value:null,id:"type",label:"Тип",items:w,rules:(0,v.v)()}),P=(0,n.qj)([]),F=(0,n.qj)({inn:{value:"",id:"inn",label:"ИНН",rules:m()},fullname:{value:"",id:"fullname",label:"Полное наименование",rules:(0,v.v)()},name:{value:"",id:"name",label:"Краткое наименование",rules:(0,v.v)()},website:{value:"",id:"website",label:"Сайт"},email:{value:"",id:"email",label:"E-mail",rules:(0,s.D)()},comment:{value:"",id:"comment",rules:(0,c.F)()}});function k(e){if(e)for(const a of e)P.push({phone:a.phone,type:a.type,extra:a.extra,typeDisabled:!0});else P.push({phone:"",type:{value:"work",text:h.value.phone.type["work"]},extra:"",typeDisabled:!0})}function Z(e){P.length>1&&P.splice(e,1)}function g(){const e={};Object.entries(F).forEach((([a,l])=>{l.value&&(e[a]=l.value)})),e.phone=[];for(const a of P)a.phone&&a.type.value&&e.phone.push(a);return e.type=y.value?y.value.value:"",e}function N(){Object.values(F).forEach((e=>e.value="")),y.value=null,b()}function W(a){N(),e.back()}async function R(){void 0===U.value[l]&&await S.fetch(l),y.value=w.value.find((e=>e.value===U.value[l].type.value))||null,k(U.value[l].phone),F.fullname.value=U.value[l].fullname,F.inn.value=U.value[l].inn,F.name.value=U.value[l].name,F.website.value=U.value[l].website||"",F.email.value=U.value[l].email||"",F.comment.value=U.value[l].comment||""}async function j(){await S.edit(g(),l)}return{partnerType:y,partnerPhone:P,fields:F,successCallback:W,prepareData:g,setFieldRef:d,validateForm:f,editPartner:j,fillFromSelectedPartner:R,addPartnerPhone:k,removePartnerPhone:Z}}},2243:function(e,a,l){l.r(a),l.d(a,{default:function(){return Z}});var t=l(3396),n=l(2793),u=l(9242),r=l(4870),i=l(140),o=l(6144),s=l(9546),c=l(7174),v=l(3874),d=l(9152),m=l(9286),p=l(3856),f=l(7229),b=l(1411);const S=["onSubmit"];var U=(0,t.aZ)({__name:"LacEditPartnerForm",setup(e){const{computedCols:a}=(0,b.b)(),{fields:l,partnerType:n,partnerPhone:U,setFieldRef:h,successCallback:w,validateForm:y,addPartnerPhone:P,removePartnerPhone:F,editPartner:k,fillFromSelectedPartner:Z}=(0,f.d)(),g=((0,d.N)(),(0,m.N)());async function N(){const e=await y();if(e)try{g.open(p.y.LOADER),await k(),g.open(p.y.SUCCESS,{callback:w})}catch(a){g.open(p.y.ERROR,{text:a.message})}}return(0,t.bv)((async()=>{await Z()})),(e,d)=>{const m=(0,t.up)("Button");return(0,t.wg)(),(0,t.iD)("form",{class:"lac-form lac-create-partner-form",onSubmit:(0,u.iM)(N,["prevent"])},[(0,t.Wm)(i.Z,{title:"Общие параметры",class:"mb16 lac-fieldset-params",grid:(0,r.SU)(a)},{default:(0,t.w5)((()=>[(0,t.Wm)(o.Z,{variant:"horizontal",value:(0,r.SU)(l).fullname.value,"onUpdate:value":d[0]||(d[0]=e=>(0,r.SU)(l).fullname.value=e),id:(0,r.SU)(l).fullname.id,label:(0,r.SU)(l).fullname.label,rules:(0,r.SU)(l).fullname.rules,placeholder:"",ref:(0,r.SU)(h)},null,8,["value","id","label","rules"]),(0,t.Wm)(c.Z,{variant:"horizontal",value:(0,r.SU)(n).value,"onUpdate:value":d[1]||(d[1]=e=>(0,r.SU)(n).value=e),items:(0,r.SU)(n).items,id:(0,r.SU)(n).id,label:(0,r.SU)(n).label,rules:(0,r.SU)(n).rules,placeholder:"",ref:(0,r.SU)(h)},null,8,["value","items","id","label","rules"]),(0,t.Wm)(o.Z,{variant:"horizontal",value:(0,r.SU)(l).name.value,"onUpdate:value":d[2]||(d[2]=e=>(0,r.SU)(l).name.value=e),id:(0,r.SU)(l).name.id,label:(0,r.SU)(l).name.label,rules:(0,r.SU)(l).name.rules,placeholder:"",ref:(0,r.SU)(h)},null,8,["value","id","label","rules"]),(0,t.Wm)(o.Z,{variant:"horizontal",value:(0,r.SU)(l).inn.value,"onUpdate:value":d[3]||(d[3]=e=>(0,r.SU)(l).inn.value=e),id:(0,r.SU)(l).inn.id,label:(0,r.SU)(l).inn.label,rules:(0,r.SU)(l).inn.rules,placeholder:"",ref:(0,r.SU)(h)},null,8,["value","id","label","rules"])])),_:1},8,["grid"]),(0,t.Wm)(i.Z,{title:"Контакты",class:"mb16 lac-fieldset-contacts"},{default:(0,t.w5)((()=>[(0,t.Wm)(o.Z,{variant:"horizontal",value:(0,r.SU)(l).website.value,"onUpdate:value":d[4]||(d[4]=e=>(0,r.SU)(l).website.value=e),id:(0,r.SU)(l).website.id,label:(0,r.SU)(l).website.label,placeholder:"",ref:(0,r.SU)(h),class:"lac-fieldset-contacts-website"},null,8,["value","id","label"]),(0,t.Wm)(o.Z,{variant:"horizontal",value:(0,r.SU)(l).email.value,"onUpdate:value":d[5]||(d[5]=e=>(0,r.SU)(l).email.value=e),id:(0,r.SU)(l).email.id,label:(0,r.SU)(l).email.label,rules:(0,r.SU)(l).email.rules,placeholder:"",class:"lac-fieldset-contacts-email",ref:(0,r.SU)(h)},null,8,["value","id","label","rules"]),(0,t.Wm)(v.Z,{value:(0,r.SU)(U),onAdd:(0,r.SU)(P),onRemove:(0,r.SU)(F)},null,8,["value","onAdd","onRemove"])])),_:1}),(0,t.Wm)(i.Z,{title:"Комментарий",class:"mb8"},{default:(0,t.w5)((()=>[(0,t.Wm)(s.Z,{"no-resize":"",rows:3,value:(0,r.SU)(l).comment.value,"onUpdate:value":d[6]||(d[6]=e=>(0,r.SU)(l).comment.value=e),id:(0,r.SU)(l).comment.id,rules:(0,r.SU)(l).comment.rules,placeholder:"",ref:(0,r.SU)(h)},null,8,["value","id","rules"])])),_:1}),(0,t.Wm)(m,{type:"submit",label:"Сохранить"})],40,S)}}});const h=U;var w=h,y=l(1020),P=l(2483),F=(0,t.aZ)({__name:"PartnerEditPage",setup(e){const a=(0,d.N)(),{selectPartnerId:l,partners:u}=(0,y.Jk)(a),i=(0,P.yj)(),o=(0,P.tv)(),s=(0,m.N)(),c=(0,r.iH)(!1),v=parseInt(i.params.id);async function f(){s.close(),await o.back()}async function b(){if(void 0===u.value[v]){const e=await a.fetch(v);if(e)return void await o.replace({name:"map"})}}const S={ok:()=>{c.value=!0,s.close()},partnerIdNotFetched:async()=>{await b(),c.value=!0,s.close()},partnerIdNotFound:async()=>{await f()},partnerIdNotFoundAndSelectPartnerNotFound:async()=>{await f()}};return(0,t.wF)((async()=>{try{return s.open(p.y.LOADER),v?l.value?void S.ok():void await S.partnerIdNotFetched():void await S.partnerIdNotFound()}catch(e){await S.partnerIdNotFoundAndSelectPartnerNotFound()}})),(e,a)=>((0,t.wg)(),(0,t.j4)(n.Z,{title:"Редактирование контрагента"},{default:(0,t.w5)((()=>[c.value?((0,t.wg)(),(0,t.j4)(w,{key:0})):(0,t.kq)("",!0)])),_:1}))}});const k=F;var Z=k}}]);
//# sourceMappingURL=partnerEdit.001848e4.js.map