"use strict";(self["webpackChunklac"]=self["webpackChunklac"]||[]).push([[50],{828:function(e,a,l){l.d(a,{Zs:function(){return u},kI:function(){return r},oU:function(){return i},vU:function(){return o}});var t=l(7542),n=l(8020);const o=async e=>{const a=await(0,t.I)().get("/agent/role/delete",{searchParams:{role:e}});if(!a)throw new n.u(o.name);return a},r=async(e={})=>{const a=await(0,t.I)().get("/agent/role/list",{searchParams:{...e,size:30}});if(!a)throw new n.u(r.name);return a},u=async e=>{const a=await(0,t.I)().post("/agent/role/add",e);if(!a)throw new n.u(u.name);return a},i=async(e,a)=>{const l=await(0,t.I)().post("/agent/role/edit",{old_role:e,new_role:a});if(!l)throw new n.u(i.name);return l}},8484:function(e,a,l){l.d(a,{D:function(){return o}});var t=l(5420);const n=e=>e.replace(/\D/g,""),o=()=>({required:t.BM.withMessage("Это поле обязательно",t.C1),minLength:t.BM.withMessage("Длина телефона должна быть не менее 10 символов",(e=>n(e).length>=10)),maxLength:t.BM.withMessage("Длина телефона должна быть не более 12 символов",(e=>n(e).length<=12))})},7495:function(e,a,l){l.d(a,{N:function(){return v}});l(7658);var t=l(4870),n=l(1020),o=l(1735),r=l(6945),u=l(8484),i=l(6342),s=l(4008),c=l(2483),d=l(6646),m=l(5845);const v=e=>{const a=(0,c.tv)(),l=(0,d.F)(),{setFieldRef:v,validateForm:p,resetValidations:f}=(0,o.Z)(),{dictionary:h}=(0,n.Jk)((0,m.o)()),g=e.map((e=>({value:e,text:e}))),b=(0,t.qj)({value:null,id:"role",label:"Должность",items:g,rules:(0,r.v)()}),U=(0,t.qj)([]),S=(0,t.qj)({name:{value:"",id:"name",label:"ФИО",rules:(0,r.v)()},phone:{value:"",id:"phone",label:"Телефон",rules:(0,u.D)()},dob:{value:"",id:"dob",label:"Дата рождения"},email:{value:"",id:"email",label:"E-mail",rules:(0,i.D)()},comment:{value:"",id:"comment",rules:(0,s.F)()}});function w(){const e={};Object.entries(S).forEach((([a,l])=>{l.value&&(e[a]=l.value)})),e.phone=[];for(const a of U)a.phone&&a.type.value&&e.phone.push(a);return e.role=b.value?b.value.value:"",e}function y(e){U.length>1&&U.splice(e,1)}function R(e){if(e)for(const a of e)U.push({phone:a.phone,type:a.type,extra:a.extra});else U.push({phone:"",type:{value:"work",text:h.value.phone.type["work"]},extra:""})}function k(e){a.back()}function A(e){b.value=g.find((a=>a.value===e.role))||null,R(e.phone),S.name.value=e.name,S.dob.value=e.dob||"",S.email.value=e.email||"",S.comment.value=e.comment||""}async function _(e){await l.add(e)}async function Z(e){await l.edit(e)}async function F(e){return await l.get(e)}return{employeeRole:b,agentPhone:U,fields:S,successCallback:k,prepareData:w,setFieldRef:v,validateForm:p,fillFromSelectedAgent:A,addAgent:_,editAgent:Z,getAgent:F,addAgentPhone:R,removeAgentPhone:y}}},9706:function(e,a,l){l.r(a),l.d(a,{default:function(){return A}});l(6229),l(7330),l(2062);var t=l(3396),n=l(4870),o=l(2793),r=l(2483),u=l(9242),i=l(140),s=l(6144),c=l(9546),d=l(7174),m=l(3874),v=l(9286),p=l(3856),f=l(1411),h=l(7495);const g=["onSubmit"],b=(0,t._)("br",null,null,-1);var U=(0,t.aZ)({__name:"LacAgentEditForm",props:{agentId:{},employeeRoles:{}},setup(e){const a=e,l=(0,r.tv)(),{computedCols:o}=(0,f.b)(),{fields:U,employeeRole:S,agentPhone:w,setFieldRef:y,successCallback:R,validateForm:k,prepareData:A,editAgent:_,getAgent:Z,fillFromSelectedAgent:F,addAgentPhone:D,removeAgentPhone:E}=(0,h.N)(a.employeeRoles),P=(0,n.iH)(null),W=(0,v.N)();async function x(){const e=await k();if(e)try{if(W.open(p.y.LOADER),P.value){const e=P.value.partner_id;await _({...A(),partner_id:e,agent_id:P.value.agent_id})}W.open(p.y.SUCCESS,{callback:R})}catch(a){W.open(p.y.ERROR,{text:a.message})}}return(0,t.bv)((async()=>{try{W.open(p.y.LOADER),P.value=await Z(Number(a.agentId)),F(P.value),W.close()}catch(e){W.close(),await l.back()}})),(e,a)=>{const l=(0,t.up)("Button");return(0,t.wg)(),(0,t.iD)("form",{class:"lac-form-long-dropdown lac-create-agent-form",onSubmit:(0,u.iM)(x,["prevent"])},[(0,t.Wm)(i.Z,{title:"Общие параметры",class:"mb16 lac-fieldset-params",grid:(0,n.SU)(o)},{default:(0,t.w5)((()=>[(0,t.Wm)(s.Z,{variant:"horizontal",value:(0,n.SU)(U).name.value,"onUpdate:value":a[0]||(a[0]=e=>(0,n.SU)(U).name.value=e),id:(0,n.SU)(U).name.id,label:(0,n.SU)(U).name.label,rules:(0,n.SU)(U).name.rules,placeholder:"",ref:(0,n.SU)(y)},null,8,["value","id","label","rules"]),(0,t.Wm)(s.Z,{class:"lac-fieldset-params-dob",variant:"horizontal",value:(0,n.SU)(U).dob.value,"onUpdate:value":a[1]||(a[1]=e=>(0,n.SU)(U).dob.value=e),id:(0,n.SU)(U).dob.id,label:(0,n.SU)(U).dob.label,rules:(0,n.SU)(U).dob.rules,placeholder:"",ref:(0,n.SU)(y),type:"date"},null,8,["value","id","label","rules"]),(0,t.Wm)(d.Z,{class:"lac-fieldset-role",variant:"horizontal",value:(0,n.SU)(S).value,"onUpdate:value":a[2]||(a[2]=e=>(0,n.SU)(S).value=e),items:(0,n.SU)(S).items,id:(0,n.SU)(S).id,label:(0,n.SU)(S).label,rules:(0,n.SU)(S).rules,placeholder:"",ref:(0,n.SU)(y)},null,8,["value","items","id","label","rules"])])),_:1},8,["grid"]),(0,t.Wm)(i.Z,{title:"Контакты",class:"mb16 lac-fieldset-contacts"},{default:(0,t.w5)((()=>[(0,t.Wm)(s.Z,{class:"lac-fieldset-contacts-email",variant:"horizontal",value:(0,n.SU)(U).email.value,"onUpdate:value":a[3]||(a[3]=e=>(0,n.SU)(U).email.value=e),id:(0,n.SU)(U).email.id,label:(0,n.SU)(U).email.label,rules:(0,n.SU)(U).email.rules,placeholder:"",ref:(0,n.SU)(y)},null,8,["value","id","label","rules"]),b,(0,t.Wm)(m.Z,{value:(0,n.SU)(w),onAdd:(0,n.SU)(D),onRemove:(0,n.SU)(E)},null,8,["value","onAdd","onRemove"])])),_:1}),(0,t.Wm)(i.Z,{title:"Комментарий",class:"mb8"},{default:(0,t.w5)((()=>[(0,t.Wm)(c.Z,{"no-resize":"",rows:3,value:(0,n.SU)(U).comment.value,"onUpdate:value":a[4]||(a[4]=e=>(0,n.SU)(U).comment.value=e),id:(0,n.SU)(U).comment.id,rules:(0,n.SU)(U).comment.rules,placeholder:"",ref:(0,n.SU)(y)},null,8,["value","id","rules"])])),_:1}),(0,t.Wm)(l,{type:"submit",label:"Сохранить"})],40,g)}}});const S=U;var w=S,y=l(828),R=(0,t.aZ)({__name:"PartnerAgentEditPage",setup(e){const a=(0,r.yj)(),l=(0,r.tv)(),u=(0,v.N)(),i=(0,n.iH)([]),s=(0,n.iH)(!1);return(0,t.wF)((async()=>{try{u.open(p.y.LOADER);const e=await(0,y.kI)();if(e.error||!e.data?.info?.length){const e=()=>{location.href=new URL(location.href).toString()};return void u.open(p.y.ERROR,{text:"Ошибка. Отсутствуют должности агентов",callback:e})}i.value=e.data.info,s.value=!0,u.close()}catch(e){u.close(),await l.back()}})),(e,l)=>((0,t.wg)(),(0,t.j4)(o.Z,{title:"Редактирование сотрудника"},{default:(0,t.w5)((()=>[s.value?((0,t.wg)(),(0,t.j4)(w,{key:0,"agent-id":(0,n.SU)(a).params.id,employeeRoles:i.value},null,8,["agent-id","employeeRoles"])):(0,t.kq)("",!0)])),_:1}))}});const k=R;var A=k}}]);
//# sourceMappingURL=partnerAgentEdit.de910afa.js.map